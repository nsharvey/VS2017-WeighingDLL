<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Step 1: Preparing the Program</title><link rel="Prev" href="viewstoocx.02.02.html" title="Previous" /><link rel="Next" href="viewstoocx.02.04.html" title="Next" /><link rel="StyleSheet" href="css/viewstoocx.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/viewstoocx_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Tutorials/viewstoocx.02.03.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pAki7Vn62DZseLRqr6LsY4w" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Tutorials/viewstoocx.02.03.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/foundtutfrontcover.html#wwconnect_header">Views Foundation</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/viewstoocx.02.01.html#wwconnect_header">Creating an ActiveX Control from Existing Rogue Wave&nbsp;Views Code</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/viewstoocx.02.02.html#wwconnect_header">Creating an ActiveX Control with the ATL Library</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Step 1: Preparing the Program</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww999127" class="Heading2"><span></span>Step 1: Preparing the Program</div><div id="ww1005706" class="Body">This step prepares the sample application used as a starting point for this tutorial so that it can be transformed to an ActiveX control and used inside another application. Basically what you have to do is separate the data from the code and make it possible to create the main view either as a top view (which is the case in the original program) or as a child view which can become part of a parent window.</div><div id="ww999056" class="Body">Also these modifications will make it easier for you to add new functionality to the ActiveX control. The modified files are in the <span class="code">step1</span> directory.</div><div id="ww1007199" class="Body">You are going to:</div><div id="ww1007200" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.03.html#ww999298" title="Step 1: Preparing the Program">Separate data from the code and put it into an .ilv file.</a></div><div id="ww1007207" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.03.html#ww999301" title="Step 1: Preparing the Program">Encapsulate the initialization code in a Ctrl class.</a></div><div id="ww1007216" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.03.html#ww999082" title="Step 1: Preparing the Program">Create a resource file (.rc) with ilv2data.</a></div><div id="ww1007221" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.03.html#ww999085" title="Step 1: Preparing the Program">Modify the manager.cpp file.</a></div><div id="ww999298" class="Heading4">Separate data from the code and put it into an .ilv file.</div><div id="ww999202" class="Body">Data stored in <span class="code">.ilv</span> files is easier to modify than data stored as a string in a <span class="code">.cpp</span> file. Also, any dependency problems can be solved with the Rogue Wave&nbsp;Views data files packaging tool, ilv2data.</div><div id="ww1004364" class="Body">The result is in the file <span class="code">step1\data\ctrl.ilv</span>. </div><div id="ww1004370" class="Body">Notice that we have added attachments so that the main view can be resized in a consistent way. Also, we have named objects so that they can be accessed more easily from the program. All of these enhancements were made with Rogue Wave&nbsp;Views Studio. </div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1006086" class="Note"><span class="flag">Note:&nbsp;</span>The separation of data from the code is not really necessary in this tutorial. However it is recommended to facilitate modifications.</div></td></tr></table></div><div id="ww999301" class="Heading4">Encapsulate the initialization code in a Ctrl class.</div><div id="ww1004389" class="Body">The initialization code is encapsulated in the <span class="code">Ctrl</span> class that will be used to create the ActiveX control and interact with it.</div><div id="ww1004390" class="Body">This class is declared in the file <span class="code">step1\ctrl.h</span> and is defined in the file <span class="code">step1\ctrl.cpp</span>. This <span class="code">cpp</span> file also stores the callback functions. </div><div id="ww999066" class="Body">The <span class="code">Ctrl</span> class is basic. It derives from <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetContainer.html">IlvGadgetContainer</a></span>. It is composed of only three constructors and four member functions, of which one is private: </div><div id="ww999068" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The first constructor creates the <span class="code">Ctrl</span> object as a top view, as in the original version of the file. It is used in the main function in <span class="code">step1\manager.cpp</span> and has the following signature:</div><div id="ww999230" class="LastNormalCodeL1">Ctrl(IlvDisplay* display, const IlvRect&amp; size, const char* filename = 0) </div><div id="ww999071" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The second constructor creates the <span class="code">Ctrl</span> object as a child view. It has the following signature:</div><div id="ww999245" class="NormalCodeL1">Ctrl(IlvDisplay* display, </div><div id="ww1001559" class="NormalCodeL1">     IlvSystemView parent, </div><div id="ww1001560" class="NormalCodeL1">     const IlvRect&amp; size, </div><div id="ww999335" class="LastNormalCodeL1">     const char* filename = 0) </div><div id="ww999074" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The third constructor creates the <span class="code">Ctrl</span> object using the existing system view. It will be used to create the ActiveX control. It has the following signature:</div><div id="ww999259" class="LastNormalCodeL1">Ctrl(IlvDisplay* display, IlvSystemView parent, const char* filename = 0) </div><div id="ww999077" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The public member functions <span class="code">getManagerRectangle</span>, <span class="code">getManagerView</span>, and <span class="code">getManager</span> provide access to the objects loaded in the control. The private member function <span class="code">init</span> is called to initialize the control, that is, read the data file, associate the callbacks with the objects, and so on. Most of the code that was originally in the member function <span class="code">PopupManager</span> has been transferred to this class. </div><div id="ww999082" class="Heading4">Create a resource file (.rc) with ilv2data.</div><div id="ww1001574" class="Body">Using <span class="code">ilv2data</span>, we create an <span class="code">.rc</span> file that contains the files <span class="code">step1\data\ctrl.ilv</span> and <span class="code">step1\data\browse.ilv</span>. This resource file could be used in this program, but we will use it later to build the ActiveX control. </div><div id="ww1004421" class="Body">For more information on <span class="code">ilv2data</span>, see <span class="emphasis">Packaging </span>Rogue Wave&nbsp;Views<span class="emphasis"> Application</span>s. </div><div id="ww999085" class="Heading4">Modify the manager.cpp file.</div><div id="ww1001593" class="Body">The file <span class="code">step1\manager.cpp</span> contains only the main function, which creates an instance of <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvDisplay.html">IlvDisplay</a></span> and an instance of the new <span class="code">Ctrl</span> class. </div><div id="ww999088" class="NormalCode">int</div><div id="ww999089" class="NormalCode">main(int argc, char* argv[])</div><div id="ww999090" class="NormalCode">{</div><div id="ww999091" class="NormalCode">    IlvDisplay* display =  new IlvDisplay("IlvDemo", "", argc, argv);</div><div id="ww999092" class="NormalCode">    if (!display || display-&gt;isBad()) {</div><div id="ww999093" class="NormalCode">        if (display)</div><div id="ww999094" class="NormalCode">            delete display;</div><div id="ww999095" class="NormalCode">        IlvFatalError("Couldn’t create display");</div><div id="ww999096" class="NormalCode">        return 1;</div><div id="ww999097" class="NormalCode">    }</div><div id="ww999098" class="NormalCode">    Ctrl* ctrl = new Ctrl(display, IlvRect(0, 0, 400, 400));</div><div id="ww999099" class="NormalCode">    IlvMainLoop();</div><div id="ww999100" class="NormalCode">    return 0;</div><div id="ww998402" class="LastNormalCode">}</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>