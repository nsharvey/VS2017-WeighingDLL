<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Step 2: Browsing Files</title><link rel="Prev" href="viewfile.05.2.html" title="Previous" /><link rel="Next" href="viewfile.05.4.html" title="Next" /><link rel="StyleSheet" href="css/viewfile.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/viewfile_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Tutorials/viewfile.05.3.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pMo10QpTYj5XL_002fDlDEiEUrA" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Tutorials/viewfile.05.3.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/gadgtutfrontcover.html#wwconnect_header">Gadgets</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/viewfile.05.1.html#wwconnect_header">The ViewFile Application: Building a Simple File Browser</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Step 2: Browsing Files</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww999941" class="Heading1"><span></span>Step 2: Browsing Files</div><div id="ww1001711" class="Body">In <a href="../Tutorials/viewfile.05.2.html#ww999938" title="Step 1: Building the Browser Window">Step 1: Building the Browser Window</a> you saw how to create the graphic objects for displaying a hierarchical list of files. This second step shows how to define and instantiate the file browser, that is, the object used to fill the graphic objects (the tree and the sheet). The class used to browse the hard disk is <span class="code">FileViewer</span>. It is declared in the file <span class="code">viewer.h</span> and defined in the file <span class="code">viewer.cpp</span>. </div><div id="ww1003599" class="Body">This step shows you how to perform the following tasks:</div><div id="ww1003606" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000417" title="Step 2: Browsing Files">Creating the File Browser</a></div><div id="ww1003610" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000505" title="Step 2: Browsing Files">Creating the Gadget Items</a></div><div id="ww1003614" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000537" title="Step 2: Browsing Files">Instantiating the File Viewer</a></div><div id="ww1003619" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000565" title="Step 2: Browsing Files">Previewing the Application</a> </div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1000635" class="Note"><span class="flag">Note:&nbsp;</span>The classes <span class="ClassName"><a href="../RefMan/refcppdblink/classIlPathName.html">IlPathName</a></span> and <span class="ClassName"><a href="../RefMan/refcppdblink/classIlString.html">IlString</a></span> seen in the code for this step are used to make the code easier to read.</div></td></tr></table></div><div id="ww1000417" class="Subhead"><span></span>Creating the File Browser</div><div id="ww1001736" class="Body">The <span class="code">FileViewer</span> class is long and complex. This section explains its main parts:</div><div id="ww1001738" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1001737" title="Step 2: Browsing Files">The Constructor</a></div><div id="ww1001743" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1005045" title="Step 2: Browsing Files">Initializing the Tree</a></div><div id="ww1001748" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000442" title="Step 2: Browsing Files">Initializing the Sheet</a></div><div id="ww1001753" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000451" title="Step 2: Browsing Files">Scanning Directories</a></div><div id="ww1001758" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewfile.05.3.html#ww1000462" title="Step 2: Browsing Files">Updating the Sheet</a></div><div id="ww1001737" class="Heading3"><span></span>The Constructor</div><div id="ww1000419" class="Body">The <span class="code">FileViewer</span> constructor requires an <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> and an <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvSheet.html">IlvSheet</a></span> as its parameters. Both objects are initialized by the <span class="code">initObjects</span> member function:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007521" class="CodeInTable">FileViewer::FileViewer(IlvTreeGadget* tree, IlvSheet* sheet)</div><div id="ww1007522" class="CodeInTable">: _tree(tree), _sheet(sheet)</div><div id="ww1007523" class="CodeInTable">{</div><div id="ww1007524" class="CodeInTable">    // Initialize the gadgets.</div><div id="ww1007525" class="CodeInTable">    initObjects();</div><div id="ww1007517" class="CodeInTable">}</div></td></tr></table></div><div id="ww1005045" class="Heading3"><span></span>Initializing the Tree</div><div id="ww1001780" class="Body">The tree object is initialized with the <span class="code">initTree</span> member function:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007344" class="CodeInTable">void </div><div id="ww1007345" class="CodeInTable">FileViewer::initTree() </div><div id="ww1007346" class="CodeInTable">{ </div><div id="ww1007347" class="CodeInTable">    // Set up the tree gadget.</div><div id="ww1007348" class="CodeInTable">    _tree-&gt;removeAllItems(IlvFalse); </div><div id="ww1007349" class="CodeInTable">    _tree-&gt;removeCallback(IlvTreeGadget::ExpandCallbackType(), </div><div id="ww1007350" class="CodeInTable">                          TreeItemExpanded); </div><div id="ww1007351" class="CodeInTable">    _tree-&gt;addCallback(IlvTreeGadget::ExpandCallbackType(), </div><div id="ww1007352" class="CodeInTable">                       TreeItemExpanded, </div><div id="ww1007353" class="CodeInTable">                       this); </div><div id="ww1007354" class="CodeInTable">    _tree-&gt;removeCallback(IlvTreeGadget::SelectCallbackType(), </div><div id="ww1007355" class="CodeInTable">                          TreeItemSelected); </div><div id="ww1007356" class="CodeInTable">    _tree-&gt;addCallback(IlvTreeGadget::SelectCallbackType(), </div><div id="ww1007357" class="CodeInTable">                       TreeItemSelected, </div><div id="ww1007358" class="CodeInTable">                       this); </div><div id="ww1007340" class="CodeInTable">}</div></td></tr></table></div><div id="ww1005673" class="Body">This member function removes all the items in the tree and sets two callbacks—a selection callback that updates the sheet whenever a new folder is selected in the tree, and a callback that is triggered each time a tree item is expanded. This second callback prevents the <span class="code">FileViewer</span> object from loading the entire file hierarchy at once, which would slow down the operation. Folders are loaded only when expanded.  </div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1006313" class="Note"><span class="flag">Note:&nbsp;</span>Each callback is removed prior to being added to avoid registering the same callback twice.</div></td></tr></table></div><div id="ww1005679" class="Body">For more information, see “Callbacks” in Graphic Objects.</div><div id="ww1000442" class="Heading3"><span></span>Initializing the Sheet</div><div id="ww1000791" class="Body">The sheet is initialized with the <span class="code">initSheet</span> member function:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007301" class="CodeInTable">void</div><div id="ww1007302" class="CodeInTable">FileViewer::initSheet()</div><div id="ww1007303" class="CodeInTable">{</div><div id="ww1007304" class="CodeInTable">    // Set up the sheet.</div><div id="ww1007305" class="CodeInTable">    _sheet-&gt;scrollBarShowAsNeeded(IlvTrue, IlvFalse);</div><div id="ww1007306" class="CodeInTable">    _sheet-&gt;hideScrollBar(IlvHorizontal, IlvFalse);</div><div id="ww1007307" class="CodeInTable">    _sheet-&gt;adjustLast(IlvTrue);</div><div id="ww1007308" class="CodeInTable">    _sheet-&gt;reinitialize(3, 1);</div><div id="ww1007309" class="CodeInTable">    _sheet-&gt;setNbFixedColumn(0);</div><div id="ww1007310" class="CodeInTable">    _sheet-&gt;scrollToColumn(0);</div><div id="ww1007311" class="CodeInTable">    _sheet-&gt;setExclusive(IlvTrue);</div><div id="ww1007312" class="CodeInTable">    _sheet-&gt;allowEdit(IlvFalse);</div><div id="ww1007313" class="CodeInTable">&nbsp;</div><div id="ww1007314" class="CodeInTable">    // Create the header.</div><div id="ww1007315" class="CodeInTable">    _sheet-&gt;set(0, 0, new IlvLabelMatrixItem("Name"));</div><div id="ww1007316" class="CodeInTable">    _sheet-&gt;setItemAlignment(0, 0, IlvLeft);</div><div id="ww1007317" class="CodeInTable">    _sheet-&gt;setItemRelief(0, 0, IlvTrue);</div><div id="ww1007318" class="CodeInTable">    _sheet-&gt;setItemSensitive(0, 0, IlvFalse);</div><div id="ww1007319" class="CodeInTable">    _sheet-&gt;setItemGrayed(0, 0, IlvFalse);</div><div id="ww1007320" class="CodeInTable">    _sheet-&gt;set(1, 0, new IlvLabelMatrixItem("Size"));</div><div id="ww1007321" class="CodeInTable">    _sheet-&gt;setItemRelief(1, 0, IlvTrue);</div><div id="ww1007322" class="CodeInTable">    _sheet-&gt;setItemSensitive(1, 0, IlvFalse);</div><div id="ww1007323" class="CodeInTable">    _sheet-&gt;setItemGrayed(1, 0, IlvFalse);</div><div id="ww1007324" class="CodeInTable">    _sheet-&gt;set(2, 0, new IlvLabelMatrixItem("Type"));</div><div id="ww1007325" class="CodeInTable">    _sheet-&gt;setItemAlignment(2, 0, IlvLeft);</div><div id="ww1007326" class="CodeInTable">    _sheet-&gt;setItemRelief(2, 0, IlvTrue);</div><div id="ww1007327" class="CodeInTable">    _sheet-&gt;setItemSensitive(2, 0, IlvFalse);</div><div id="ww1007328" class="CodeInTable">    _sheet-&gt;setItemGrayed(2, 0, IlvFalse);</div><div id="ww1007297" class="CodeInTable">}</div></td></tr></table></div><div id="ww1001799" class="Body">This member function modifies the sheet so that it has three columns and only one row in which the sheet header will be displayed. Column 1 will contain file names, column 2 will contain the size of the files, and column 3 will provide information about the file type, as shown in the following figure:</div><div class="ww_skin_page_overflow"><div id="ww1004998" class="Startfigure"> <img class="Default" src="../Tutorials/images/columns.gif" width="100%" style="display: block; left: 0.0pt; max-height: 40px; max-width: 362px; top: 0.0pt" alt="" />   </div></div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1000773" class="Note"><span class="flag">Note:&nbsp;</span>The items making up the header are set to insensitive, meaning that the user will not be able to select them.</div></td></tr></table></div><div id="ww1000451" class="Heading3"><span></span>Scanning Directories </div><div id="ww1000452" class="Body">The <span class="code">fillTree</span> member function fills the tree with data once it is initialized. It reads the contents of a given directory and creates the corresponding items in the tree:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007260" class="CodeInTable">void</div><div id="ww1007261" class="CodeInTable">FileViewer::fillTree(IlvPathName&amp; path, IlvTreeGadgetItem* parent)</div><div id="ww1007262" class="CodeInTable">{</div><div id="ww1007263" class="CodeInTable">    // Read the 'path' directory and insert each sub-folder as a child of</div><div id="ww1007264" class="CodeInTable">    // the item 'parent'.</div><div id="ww1007265" class="CodeInTable">    if (path.openDir()) {</div><div id="ww1007266" class="CodeInTable">        IlvPathName file;</div><div id="ww1007267" class="CodeInTable">        while (path.readDir(file)) {</div><div id="ww1007268" class="CodeInTable">            if (file.isDirectory() &amp;&amp;</div><div id="ww1007269" class="CodeInTable">                file.getDirectory(IlvFalse) != IlvString(".") &amp;&amp;</div><div id="ww1007270" class="CodeInTable">                file.getDirectory(IlvFalse) != IlvString("..")) {</div><div id="ww1007271" class="CodeInTable">                IlvTreeGadgetItem* item =</div><div id="ww1007272" class="CodeInTable">                     (IlvTreeGadgetItem*)createFileItem(file, _tree);</div><div id="ww1007273" class="CodeInTable">                item-&gt;setUnknownChildCount(IlvTrue);</div><div id="ww1007274" class="CodeInTable">                // Insert the directory 'file' into parent.</div><div id="ww1007275" class="CodeInTable">                parent-&gt;insertChild(item);</div><div id="ww1007276" class="CodeInTable">                // Compute the absolute path name.</div><div id="ww1007277" class="CodeInTable">                IlvPathName* absPathName=new IlvPathName(path);</div><div id="ww1007278" class="CodeInTable">                absPathName-&gt;merge(file);</div><div id="ww1007279" class="CodeInTable">                item-&gt;setclientData(absPathName)</div><div id="ww1007280" class="CodeInTable">             }</div><div id="ww1007281" class="CodeInTable">         }</div><div id="ww1007282" class="CodeInTable">         path.closeDir();</div><div id="ww1007283" class="CodeInTable">         // Sort the added items.</div><div id="ww1007284" class="CodeInTable">         _tree-&gt;sort(parent, 1);</div><div id="ww1007285" class="CodeInTable">      }</div><div id="ww1007286" class="CodeInTable">}<span style="font-family: &quot;Times New Roman&quot;"> </span></div></td></tr></table></div><div id="ww1000454" class="Body">The <span class="code">FileViewer::createFileItem</span> member function creates each of the tree items. These are then added to their parent item, that is, to the folder being read. The added items are then sorted by the <span class="MethodName"><a href="../RefMan/refcppgadgets/classIlvTreeGadgetItemHolder.html#a531d58aacd13f2aae58e4fc387ad4486">sort</a></span> member function.</div><div id="ww1001014" class="Body">The content of <span class="code">createFileItem</span> is described in <a href="../Tutorials/viewfile.05.3.html#ww1000505" title="Step 2: Browsing Files">Creating the Gadget Items</a>.   </div><div class="ww_skin_page_overflow"><table class="NotesTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503653543307pt"><div id="ww1006268" class="Notes"><span class="flag">Notes:&nbsp;</span>&nbsp;</div><div id="ww1006269" class="NoteNumbered1"><span class="WebWorks_Number" style="width: 11.338582677165359pt"><span class="number">1.	</span></span>The member function <span class="MethodName"><a href="../RefMan/refcppgadgets/classIlvTreeGadgetItem.html#a28259041b3e91addbbc10553ce26495c">setUnknownChildCount</a></span> is called for each added item to ensure that the Expand callback is invoked. For more information, see “Changing the Characteristics of an Item” in Using Common Gadgets. </div><div id="ww1006281" class="NoteNumbered"><span class="WebWorks_Number" style="width: 11.338582677165359pt"><span class="number">2.	</span></span>The client data of an item is used to store the path object that references the directory that the item points to. This object is a cache that avoids recomputing the absolute path of the item each time.</div></td></tr></table></div><div id="ww1000457" class="Body">The <span class="code">fillTree</span> method fills only one node of the tree. The whole tree is actually built by the Expand callback:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007199" class="CodeInTable">static void</div><div id="ww1007200" class="CodeInTable">TreeItemExpanded(IlvGraphic* g, IlvAny arg)</div><div id="ww1007201" class="CodeInTable">{</div><div id="ww1007202" class="CodeInTable">    IlvTreeGadgetItem* item = ((IlvTreeGadget*)g)-&gt;getCallbackItem();</div><div id="ww1007203" class="CodeInTable">    if (!item-&gt;hasChildren()) {</div><div id="ww1007204" class="CodeInTable">        FileViewer* viewer = (FileViewer*)arg;</div><div id="ww1007205" class="CodeInTable">        IlvPathName* path = (IlvPathName*)item-&gt;getClientData();</div><div id="ww1007206" class="CodeInTable">        viewer-&gt;updateTree(*path, item);</div><div id="ww1007207" class="CodeInTable">     }</div><div id="ww1007208" class="CodeInTable">}<span style="font-family: &quot;Times New Roman&quot;"> </span></div></td></tr></table></div><div id="ww1000459" class="Body">This callback is invoked each time the user tries to expand a collapsed folder. The <span class="code">arg</span> parameter is a pointer to the <span class="code">FileViewer</span> object, as specified when the callback was set. The path that was stored as the item client data is retrieved and used to update the tree. Since you want to update the tree only if the folder has never been open, ensure that the item being expanded has no children before calling the <span class="code">updateTree</span> method:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007238" class="CodeInTable">void</div><div id="ww1007239" class="CodeInTable">FileViewer::updateTree(IlvPathName&amp; path, IlvTreeGadgetItem* item)</div><div id="ww1007240" class="CodeInTable">{</div><div id="ww1007241" class="CodeInTable">     _tree-&gt;initReDrawItems();</div><div id="ww1007242" class="CodeInTable">     // Reset the tree, if needed.</div><div id="ww1007243" class="CodeInTable">     if (!item)</div><div id="ww1007244" class="CodeInTable">         initTree();</div><div id="ww1007245" class="CodeInTable">     // Fill it using the 'path' directory.</div><div id="ww1007246" class="CodeInTable">     fillTree(path, item? item : _tree-&gt;getRoot());</div><div id="ww1007247" class="CodeInTable">     // Finally, redraw.</div><div id="ww1007248" class="CodeInTable">     _tree-&gt;reDrawItems();</div><div id="ww1007219" class="CodeInTable">}</div></td></tr></table></div><div id="ww1000461" class="Body">This member function calls the <span class="code">fillTree</span> member function and performs additional operations such as cleaning the tree and handling smart redrawing. See “Redrawing Gadget Items” in Gadget Items.</div><div id="ww1000462" class="Heading3"><span></span>Updating the Sheet</div><div id="ww1000463" class="Body">The list of files represented by an <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvSheet.html">IlvSheet</a></span> object on the right-hand side of the window must be updated each time the item selected in the tree changes. Updating is performed by the selection callback of the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> class. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007169" class="CodeInTable">static void</div><div id="ww1007170" class="CodeInTable">TreeItemSelected(IlvGraphic* g, IlvAny arg)</div><div id="ww1007171" class="CodeInTable">{</div><div id="ww1007172" class="CodeInTable">    // Retrieve the item that has triggered the callback.</div><div id="ww1007173" class="CodeInTable">    IlvTreeGadgetItem* item = ((IlvTreeGadget*)g)-&gt;getCallbackItem();</div><div id="ww1007174" class="CodeInTable">    // In the case of a selection (this callback is also called when an item</div><div id="ww1007175" class="CodeInTable">    // is deselected) update the sheet.</div><div id="ww1007176" class="CodeInTable">    if (item-&gt;isSelected()) {</div><div id="ww1007177" class="CodeInTable">        // Retrieve the path of the item.</div><div id="ww1007178" class="CodeInTable">        IlvPathName* pathname = (IlvPathName*)item-&gt;getClientData();</div><div id="ww1007179" class="CodeInTable">        // Retrieve the file viewer instance.</div><div id="ww1007180" class="CodeInTable">        FileViewer* viewer = (FileViewer*)arg;</div><div id="ww1007181" class="CodeInTable">        // Update the sheet.</div><div id="ww1007182" class="CodeInTable">        viewer-&gt;updateSheet(*pathname);</div><div id="ww1007183" class="CodeInTable">    }</div><div id="ww1007165" class="CodeInTable">}</div></td></tr></table></div><div id="ww1000465" class="Body">This callback is invoked each time a new item is selected in the tree. Once the item that triggered the callback is retrieved by the member function <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span><span class="code">::getCallbackItem</span>, it is necessary to check whether the item is selected (since the tree selection callback is also invoked when an item is deselected). Then, the path stored in the item client data is passed to the <span class="code">updateSheet</span> member function:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007123" class="CodeInTable">void</div><div id="ww1007124" class="CodeInTable">FileViewer::updateSheet(IlvPathName&amp; path)</div><div id="ww1007125" class="CodeInTable">{</div><div id="ww1007126" class="CodeInTable">    _sheet-&gt;initReDrawItems();</div><div id="ww1007127" class="CodeInTable">    // Reset the sheet.</div><div id="ww1007128" class="CodeInTable">    initSheet();</div><div id="ww1007129" class="CodeInTable">    // Read all the files contained in 'path'.</div><div id="ww1007130" class="CodeInTable">    if (path.openDir()) {</div><div id="ww1007131" class="CodeInTable">        IlvPathName file;</div><div id="ww1007132" class="CodeInTable">        while (path.readDir(file)) {</div><div id="ww1007133" class="CodeInTable">            if (!file.isDirectory() || </div><div id="ww1007134" class="CodeInTable">                (file.getDirectory(IlvFalse) != IlvString(".") &amp;&amp;</div><div id="ww1007135" class="CodeInTable">                 file.getDirectory(IlvFalse) != IlvString(".."))) {</div><div id="ww1007136" class="CodeInTable">                if (!file.isDirectory())</div><div id="ww1007137" class="CodeInTable">                    file.setDirectory(path);</div><div id="ww1007138" class="CodeInTable">                // Add the file to the sheet.</div><div id="ww1007139" class="CodeInTable">                addFile(file);</div><div id="ww1007140" class="CodeInTable">             }</div><div id="ww1007141" class="CodeInTable">         }</div><div id="ww1007142" class="CodeInTable">         path.closeDir();</div><div id="ww1007143" class="CodeInTable">    }</div><div id="ww1007144" class="CodeInTable">    // Recompute the column sizes.</div><div id="ww1007145" class="CodeInTable">    _sheet-&gt;fitWidthToSize();</div><div id="ww1007146" class="CodeInTable">    // Invalidate the whole sheet.</div><div id="ww1007147" class="CodeInTable">    _sheet-&gt;getHolder()-&gt;invalidateRegion(_sheet);</div><div id="ww1007148" class="CodeInTable">    // Finally, redraw.</div><div id="ww1007149" class="CodeInTable">    _sheet-&gt;reDrawItems();</div><div id="ww1007119" class="CodeInTable">}</div></td></tr></table></div><div id="ww1000467" class="Body">This member function adds all the files specified in the directory path to the sheet using the <span class="code">addFile</span> member function. It also manages the sheet redrawing:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007541" class="CodeInTable">void<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007542" class="CodeInTable">FileViewer::addFile(const IlvPathName&amp; file) </div><div id="ww1007543" class="CodeInTable">{ </div><div id="ww1007544" class="CodeInTable">    // Create the gadget item that will be inserted into the sheet. </div><div id="ww1007545" class="CodeInTable">    IlvGadgetItem* item = createFileItem(file, _sheet); </div><div id="ww1007546" class="CodeInTable">    // Encapsulate it with a matrix item.</div><div id="ww1007547" class="CodeInTable">    IlvAbstractMatrixItem* mitem = new IlvGadgetItemMatrixItem(item); </div><div id="ww1007548" class="CodeInTable">    // Add a new row in the matrix .</div><div id="ww1007549" class="CodeInTable">    _sheet-&gt;insertRow((IlvUShort) -1); </div><div id="ww1007550" class="CodeInTable">    IlvUShort row = (IlvUShort)(_sheet-&gt;rows() - 1); </div><div id="ww1007551" class="CodeInTable">&nbsp;</div><div id="ww1007552" class="CodeInTable">    // Set the item in the first column.</div><div id="ww1007553" class="CodeInTable">    _sheet-&gt;set(0, row, mitem); </div><div id="ww1007554" class="CodeInTable">    _sheet-&gt;resizeRow((IlvUShort)(row + 1), item-&gt;getHeight() + 1); </div><div id="ww1007555" class="CodeInTable">    _sheet-&gt;setItemAlignment(0, row, _sheet-&gt;getItemAlignment(0, 0)); </div><div id="ww1007556" class="CodeInTable">    // File Size in the second column.</div><div id="ww1007557" class="CodeInTable">    _sheet-&gt;setItemSensitive(1, row, IlvFalse); </div><div id="ww1007558" class="CodeInTable">    _sheet-&gt;setItemGrayed(1, row, IlvFalse); </div><div id="ww1007559" class="CodeInTable">    _sheet-&gt;setItemAlignment(1, row, _sheet-&gt;getItemAlignment(1, 0)); </div><div id="ww1007560" class="CodeInTable">    ifstream ifile(file.getString(), IlvBinaryInputStreamMode); </div><div id="ww1007561" class="CodeInTable">    if (!(!ifile)) { </div><div id="ww1007562" class="CodeInTable">        ifile.seekg(0, ios::end); </div><div id="ww1007563" class="CodeInTable">        streampos length = ifile.tellg(); </div><div id="ww1007564" class="CodeInTable">        mitem = new IlvIntMatrixItem(length); </div><div id="ww1007565" class="CodeInTable">        _sheet-&gt;set(1, row, mitem); </div><div id="ww1007566" class="CodeInTable">    } </div><div id="ww1007567" class="CodeInTable">    // File Type in the third column.</div><div id="ww1007568" class="CodeInTable">    mitem = new IlvLabelMatrixItem(file.isDirectory() </div><div id="ww1007569" class="CodeInTable">                                   ? "File Folder" </div><div id="ww1007570" class="CodeInTable">                                   : "File"); </div><div id="ww1007571" class="CodeInTable">    _sheet-&gt;setItemSensitive(2, row, IlvFalse); </div><div id="ww1007572" class="CodeInTable">    _sheet-&gt;setItemGrayed(2, row, IlvFalse); </div><div id="ww1007573" class="CodeInTable">    _sheet-&gt;setItemAlignment(2, row, _sheet-&gt;getItemAlignment(2, 0)); </div><div id="ww1007574" class="CodeInTable">    _sheet-&gt;set(2, row, mitem); </div><div id="ww1007575" class="CodeInTable">}<span style="font-family: &quot;Times New Roman&quot;"> </span></div></td></tr></table></div><div id="ww1000502" class="Body">This member function creates the item corresponding to the file parameter provided as its argument and adds it to the first column of the sheet. Then, it retrieves the file size and puts it in the second column as an <span class="code">IlvIntMatrixItem</span> object. Finally, it puts the file type in the third column as an <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvLabelMatrixItem.html">IlvLabelMatrixItem</a></span> object.</div><div id="ww1000503" class="Body">Both the second and third column items are set to insensitive, meaning that the user will not be able to select them.</div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1001871" class="Note"><span class="flag">Note:&nbsp;</span>The file names in the first column of the sheet are created with the same method as the one used for building the tree. </div></td></tr></table></div><div id="ww1000505" class="Subhead"><span></span>Creating the Gadget Items</div><div id="ww1000506" class="Body">The member function <span class="code">FileViewer::createFileItem</span> creates the items:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007590" class="CodeInTable">IlvGadgetItem*</div><div id="ww1007591" class="CodeInTable">FileViewer::createFileItem(const IlvPathName&amp; file,</div><div id="ww1007618" class="CodeInTable">                           const IlvGadgetItemHolder* holder) const</div><div id="ww1007619" class="CodeInTable">{</div><div id="ww1007620" class="CodeInTable">    // Compute the item label.</div><div id="ww1007595" class="CodeInTable">    IlvString filename = file.isDirectory()</div><div id="ww1007596" class="CodeInTable">        ? file.getString()</div><div id="ww1007597" class="CodeInTable">        : file.getBaseName();</div><div id="ww1007598" class="CodeInTable">    // If file is a directory, remove the trailing '/'.</div><div id="ww1007599" class="CodeInTable">    if (file.isDirectory())</div><div id="ww1007600" class="CodeInTable">        filename.remove(filename.getLength() - 1);</div><div id="ww1007601" class="CodeInTable">    return</div><div id="ww1007602" class="CodeInTable">        holder-&gt;createItem(filename,</div><div id="ww1007603" class="CodeInTable">                           0,</div><div id="ww1007604" class="CodeInTable">                           getBitmap(file, IlvGadgetItem::BitmapSymbol()),</div><div id="ww1007605" class="CodeInTable">                           getBitmap(file,</div><div id="ww1007606" class="CodeInTable">                                     IlvGadgetItem::SelectedBitmapSymbol()));</div><div id="ww1007607" class="CodeInTable">} </div></td></tr></table></div><div id="ww1005930" class="Body">A gadget item can include both a picture and a label. For a detailed description of gadget items, see Gadget Items. The item label is computed from the file parameter. Items are assigned two bitmaps—one that represents them when they are selected and one that represents them when they are not selected.</div><div id="ww1005933" class="Body">Then, the item is created using the factory member function <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetItemHolder.html">IlvGadgetItemHolder</a></span><span class="code">::createItem</span>, which is called on the holder instance provided as its parameter. See “Creating Gadget Items” in Gadget Items.</div><div id="ww1000510" class="Body">In the section <a href="../Tutorials/viewfile.05.3.html#ww1000451" title="Step 2: Browsing Files">Scanning Directories</a>, the items of both the tree and the sheet are created by calling this method. This is because the classes <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> and <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvSheet.html">IlvSheet</a></span> both inherit from the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetItemHolder.html">IlvGadgetItemHolder</a></span> class. Calling the <span class="code">createFileItem</span> member function with an instance of the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> class as its holder parameter returns an instance of <span class="code">IlvTreeGadgetItem</span>, whereas calling it with an instance of <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvSheet.html">IlvSheet</a></span> returns an instance of the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetItem.html">IlvGadgetItem</a></span> class.</div><div id="ww1000511" class="Body">The member function <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetItemHolder.html">IlvGadgetItemHolder</a></span><span class="code">::createItem</span> takes two bitmaps as its third and fourth parameters. This makes it easy to create an item with predefined bitmaps.</div><div id="ww1001988" class="Body">However, the call to <span class="code">createItem</span> could have been replaced by the following code, which shows how to assign a bitmap to a gadget item:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007629" class="CodeInTable">IlvGadgetItem* item = holder-&gt;createItem(filename); </div><div id="ww1007630" class="CodeInTable">item-&gt;setBitmap(IlvGadgetItem::BitmapSymbol(), </div><div id="ww1007631" class="CodeInTable">                getBitmap(file, IlvGadgetItem::BitmapSymbol())); </div><div id="ww1007632" class="CodeInTable">item-&gt;setBitmap(IlvGadgetItem::SelectedBitmapSymbol(), </div><div id="ww1007633" class="CodeInTable">                getBitmap(file, IlvGadgetItem::SelectedBitmapSymbol())); </div><div id="ww1007634" class="CodeInTable">return item; </div></td></tr></table></div><div id="ww1003100" class="Body">The <span class="code">getBitmap</span> method used here returns the bitmap corresponding to the pair file type/item state. Its code is very simple, as can be seen here:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007649" class="CodeInTable">IlvBitmap* </div><div id="ww1007650" class="CodeInTable">FileViewer::getBitmap(const IlvPathName&amp; file, </div><div id="ww1007651" class="CodeInTable">                      const IlvSymbol* state) const </div><div id="ww1007652" class="CodeInTable">{ </div><div id="ww1007653" class="CodeInTable">     if (state == IlvGadgetItem::BitmapSymbol()) </div><div id="ww1007654" class="CodeInTable">         return getBitmap(file.isDirectory() </div><div id="ww1007655" class="CodeInTable">                          ? folderBm </div><div id="ww1007656" class="CodeInTable">                          : fileBm); </div><div id="ww1007657" class="CodeInTable">     else </div><div id="ww1007658" class="CodeInTable">         return getBitmap(file.isDirectory() </div><div id="ww1007659" class="CodeInTable">                          ? sfolderBm </div><div id="ww1007660" class="CodeInTable">                          : sfileBm); </div><div id="ww1007661" class="CodeInTable">} </div></td></tr></table></div><div id="ww1000532" class="Body"><span class="code">folderBm</span>, <span class="code">fileBm</span>, <span class="code">sfolderBm</span>, and <span class="code">sfileBm</span> are defined symbols, where: </div><div id="ww1000533" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">folderBm</span> is the name of the bitmap used for folders. </div><div id="ww1000534" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">fileBm</span> is the name of the bitmap used for nonselected files. </div><div id="ww1001238" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">sfolderBm</span> is the name of the bitmap used for selected folders. </div><div id="ww1001241" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">sfileBm</span> is the name of the bitmap used for selected files. </div><div id="ww1000537" class="Subhead"><span></span>Instantiating the File Viewer</div><div id="ww1000538" class="Body">The <span class="code">FileViewer</span> class is now complete. To instantiate it in the application, you must add a call to the member function <span class="code">FileViewerApplication::configureApplication</span> in <span class="code">FileViewerApplication::makePanels</span>, which was defined in the section <a href="../Tutorials/viewfile.05.2.html#ww1003554" title="Step 1: Building the Browser Window">Creating the Main Window</a>. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007676" class="CodeInTable">void </div><div id="ww1007677" class="CodeInTable">FileViewerApplication::makePanels() </div><div id="ww1007678" class="CodeInTable">{ </div><div id="ww1007679" class="CodeInTable">    // Initialize the main window. </div><div id="ww1007680" class="CodeInTable">    initMainWindow(); </div><div id="ww1007681" class="CodeInTable">    // Initialize the application. </div><div id="ww1007682" class="CodeInTable">    configureApplication(); </div><div id="ww1007683" class="CodeInTable">    // Show it. </div><div id="ww1007684" class="CodeInTable">    getMainWindow()-&gt;show(); </div><div id="ww1007685" class="CodeInTable">} </div></td></tr></table></div><div id="ww1000549" class="Body">The <span class="code">FileViewerApplication::configureApplication</span> member function instantiates and initializes the <span class="code">FileViewer</span> class:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007700" class="CodeInTable">void<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007701" class="CodeInTable">FileViewerApplication::configureApplication()<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007702" class="CodeInTable">{<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007703" class="CodeInTable">    FileViewer* viewer = createFileViewer(getMainWindow());<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007704" class="CodeInTable">    FileViewerApplication::SetFileViewer(getMainWindow(), viewer);<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007705" class="CodeInTable">    viewer-&gt;init(IlvPathName("/"));<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007696" class="CodeInTable">}</div></td></tr></table></div><div id="ww1005061" class="Body"> </div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1001265" class="Note"><span class="flag">Note:&nbsp;</span>Calling <span class="code">FileViewerApplication::SetFileViewer</span> connects the main window to the viewer. You can retrieve the file viewer connected to a specific window with <span class="code">FileViewerApplication::GetFileViewer.</span></div></td></tr></table></div><div id="ww1000558" class="Body">The factory method <span class="code">createFileViewer</span> returns a new instance of the <span class="code">FileViewer</span> class:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007717" class="CodeInTable">FileViewer*<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007718" class="CodeInTable">FileViewerApplication::createFileViewer(FileViewerWindow* window) const<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007719" class="CodeInTable">{<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007720" class="CodeInTable">    return new FileViewer(window-&gt;getDirectoryHierarchy(),<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007721" class="CodeInTable">                          window-&gt;getFileList());<span style="font-family: &quot;Times New Roman&quot;"> </span></div><div id="ww1007722" class="CodeInTable">}<span style="font-family: &quot;Times New Roman&quot;"> </span></div></td></tr></table></div><div id="ww1000565" class="Subhead"><span></span>Previewing the Application</div><div id="ww1000412" class="Body">This is the end of Step 2. Your application window should look like this:</div><div class="ww_skin_page_overflow"><div id="ww1003990" class="Startfigure"><img class="Default" src="../Tutorials/images/viewfile2.gif" width="100%" style="display: block; left: 0.0pt; max-height: 338px; max-width: 516px; top: 0.0pt" alt="" /></div></div><div id="ww1004125" class="Caption">The ViewFile Application After Step2</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>