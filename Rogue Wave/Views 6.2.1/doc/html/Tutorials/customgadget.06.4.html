<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Step 3: Creating a Composite Gadget</title><link rel="Prev" href="customgadget.06.3.html" title="Previous" /><link rel="Next" href="aftutfrontcover.html" title="Next" /><link rel="StyleSheet" href="css/customgadget.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/customgadget_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Tutorials/customgadget.06.4.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="peQjEhZbMhv4hK3ySi6pQXQ" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Tutorials/customgadget.06.4.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/gadgtutfrontcover.html#wwconnect_header">Gadgets</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/customgadget.06.1.html#wwconnect_header">Customizing Gadgets</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Step 3: Creating a Composite Gadget</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww576298" class="Heading1"><span></span>Step 3: Creating a Composite Gadget</div><div id="ww576303" class="Body">This step explains how to create a new gadget, that is, a direct subclass of the <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGadget.html">IlvGadget</a></span> class. The gadget to be created is a composite gadget made up of three gadgets: a text field and two buttons. The <span class="code">UpDownField</span> gadget appears as follows:</div><div class="ww_skin_page_overflow"><div id="ww576304" class="Startplain"><img class="Default" src="../Tutorials/images/updown.png" width="100%" style="display: block; left: 0.0pt; max-height: 31px; max-width: 109px; top: 0.0pt" alt="" /></div></div><div id="ww576309" class="Body">This step shows you how to perform the following tasks:</div><div id="ww576311" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.4.html#ww576319" title="Step 3: Creating a Composite Gadget">Creating a Gadget Composed of Other Gadgets</a></div><div id="ww576542" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.4.html#ww576328" title="Step 3: Creating a Composite Gadget">Handling Keyboard Focus in a Gadget</a></div><div id="ww576312" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.4.html#ww576541" title="Step 3: Creating a Composite Gadget">Handling Events in a Gadget</a></div><div id="ww576318" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.4.html#ww576325" title="Step 3: Creating a Composite Gadget">Adding Callbacks to a Gadget</a></div><div id="ww578682" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.4.html#ww578630" title="Step 3: Creating a Composite Gadget">Testing the Composite Gadget</a></div><div id="ww576319" class="Subhead"><span></span>Creating a Gadget Composed of Other Gadgets</div><div id="ww576324" class="Body">Creating a composite gadget means creating a new gadget that is composed of one or more existing gadgets. This is the case for the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span>, which has internal <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvScrollBar.html">IlvScrollBar</a></span> objects to allow scrolling operations. This is also the case for the <span class="code">UpDownField</span> class created in this step.</div><div id="ww579101" class="Heading3"><span></span>Declaring the Composite Gadget</div><div id="ww576379" class="Body">To keep pointers to the objects that <span class="code">UpDownField</span> is composed of, protected member variables are used:</div><div id="ww576382" class="NormalCode">class UpDownField</div><div id="ww576384" class="NormalCode">: public IlvGadget</div><div id="ww576332" class="NormalCode">{</div><div id="ww576401" class="NormalCode">     ....</div><div id="ww577743" class="NormalCode">protected:</div><div id="ww576389" class="NormalCode">    IlvTextField* _textField;</div><div id="ww576390" class="NormalCode">    IlvButton*    _rightButton;</div><div id="ww576391" class="NormalCode">    IlvButton*    _leftButton;</div><div id="ww576394" class="LastNormalCode">   };</div><div id="ww576387" class="Heading3"><span></span>Creating the Components</div><div id="ww579106" class="Body">First, the objects that make up the composite gadget must be created. The <span class="code">UpDownField</span> class has a protected member function <span class="code">init</span> that is called by each constructor of the class:</div><div id="ww576333" class="NormalCode">void</div><div id="ww576335" class="NormalCode">UpDownField::init(const char* label)</div><div id="ww576336" class="NormalCode">{</div><div id="ww576337" class="NormalCode">    // Compute the bounding boxes of each element.</div><div id="ww576338" class="NormalCode">    IlvRect r1, r2, r3;</div><div id="ww576339" class="NormalCode">    computeRects(r1, r2, r3);</div><div id="ww576341" class="NormalCode">    // Text field.</div><div id="ww576342" class="NormalCode">    _textField   =</div><div id="ww576343" class="NormalCode">        new IlvTextField(getDisplay(),</div><div id="ww576344" class="NormalCode">                         label,</div><div id="ww576345" class="NormalCode">                         r2,</div><div id="ww576346" class="NormalCode">                         getThickness(),</div><div id="ww576347" class="NormalCode">                         getPalette());</div><div id="ww576348" class="NormalCode">    _focusGadget = _textField;</div><div id="ww576350" class="NormalCode">    // Left Button.</div><div id="ww576351" class="NormalCode">    _leftButton  = new IlvButton(getDisplay(), "-", r1, getThickness(),</div><div id="ww578287" class="NormalCode">                                 getPalette());</div><div id="ww576353" class="NormalCode">    _leftButton-&gt;setCallback(_internal_Down, this);</div><div id="ww576355" class="NormalCode">    // Right Button.</div><div id="ww576356" class="NormalCode">    _rightButton = new IlvButton(getDisplay(), "+", r3, getThickness(),</div><div id="ww578290" class="NormalCode">                                 getPalette());</div><div id="ww576358" class="NormalCode">    _rightButton-&gt;setCallback(_internal_Up, this);</div><div id="ww576359" class="LastNormalCode">}</div><div id="ww576372" class="Body">The <span class="code">init</span> method first computes the bounding boxes of all the objects by calling the <span class="code">computeRects</span> member function. Then, it creates and initializes the objects.</div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww578515" class="Note"><span class="flag">Note:&nbsp;</span><span style="color: #000000; font-family: &quot;Times New Roman&quot;; font-size: 10.0pt; font-style: italic; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">The two buttons are given a callback. The left button callback will call the </span><span class="code">UpDownField::</span><span class="code">decrement</span> method, and the right button callback will call the <span class="code">UpDownField::</span><span class="code">increment</span> method.</div></td></tr></table></div><div id="ww576406" class="Heading3"><span></span>The Layout</div><div id="ww579108" class="Body">Here is the description of the <span class="code">computeRects</span> method responsible for the layout of the <span class="code">UpDownField</span> class:</div><div id="ww576407" class="NormalCode">void</div><div id="ww576409" class="NormalCode">UpDownField::computeRects(IlvRect&amp; r1,</div><div id="ww576410" class="NormalCode">                          IlvRect&amp; r2,</div><div id="ww576411" class="NormalCode">                          IlvRect&amp; r3,</div><div id="ww576412" class="NormalCode">                          const IlvTransformer* t) const</div><div id="ww576413" class="NormalCode">{</div><div id="ww576414" class="NormalCode">    IlvRect rect = _drawrect;</div><div id="ww576415" class="NormalCode">    if (t)</div><div id="ww576416" class="NormalCode">        t-&gt;apply(rect);</div><div id="ww576417" class="NormalCode">    r1.moveResize(rect.x(), rect.y(), (IlvDim)ButtonWidth, rect.h());</div><div id="ww576418" class="NormalCode">    IlvDim width = rect.w() - (2*(ButtonWidth + Margin));</div><div id="ww576419" class="NormalCode">    r2.moveResize(rect.x() + (IlvPos)(ButtonWidth + Margin),</div><div id="ww576420" class="NormalCode">                  rect.y(),</div><div id="ww576421" class="NormalCode">                  (IlvDim)IlvMax(width, (IlvDim)0),</div><div id="ww576422" class="NormalCode">                  rect.h());</div><div id="ww576423" class="NormalCode">    IlvPos deltaX = (IlvPos)(rect.w() - ButtonWidth);</div><div id="ww576424" class="NormalCode">    r3.moveResize(rect.x() + (IlvPos)IlvMax(deltaX, (IlvPos)0),</div><div id="ww576425" class="NormalCode">                  rect.y(),</div><div id="ww576426" class="NormalCode">                  ButtonWidth,</div><div id="ww576427" class="NormalCode">                  rect.h());</div><div id="ww576428" class="NormalCode">    r1.intersection(rect);</div><div id="ww576429" class="NormalCode">    r2.intersection(rect);</div><div id="ww576430" class="NormalCode">    r3.intersection(rect);</div><div id="ww576431" class="LastNormalCode">}</div><div id="ww576433" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">r1</span> is the bounding box of the left button.</div><div id="ww576434" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">r2</span> is the bounding box of the text field.</div><div id="ww576435" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">r3</span> is the bounding box of the right button.</div><div id="ww576436" class="Body">This method is called each time the composite gadget is moved or resized. As with all graphic objects, the <span class="code">applyTransform</span> method is called in both these cases:</div><div id="ww576437" class="NormalCode">void</div><div id="ww576439" class="NormalCode">UpDownField::applyTransform(const IlvTransformer* t)</div><div id="ww576440" class="NormalCode">{</div><div id="ww576441" class="NormalCode">    IlvGadget::applyTransform(t);</div><div id="ww576442" class="NormalCode">    IlvRect r1, r2, r3;</div><div id="ww576443" class="NormalCode">    computeRects(r1, r2, r3);</div><div id="ww576444" class="NormalCode">    _rightButton-&gt;moveResize(r3);</div><div id="ww576445" class="NormalCode">    _textField-&gt;moveResize(r2);</div><div id="ww576446" class="NormalCode">    _leftButton-&gt;moveResize(r1);</div><div id="ww576447" class="LastNormalCode">}</div><div id="ww578534" class="Body">It is also used to query the composite gadget about its component bounding boxes.</div><div id="ww578535" class="Heading3"><span></span>Drawing the Components</div><div id="ww579113" class="Body">The components of the composite gadget are now well located. The composite gadget draws them by calling the <span class="code">draw</span> member function of each component:</div><div id="ww576453" class="NormalCode">void</div><div id="ww576455" class="NormalCode">UpDownField::draw(IlvPort* dst,</div><div id="ww576456" class="NormalCode">                  const IlvTransformer* t,</div><div id="ww576457" class="NormalCode">                  const IlvRegion* clip) const</div><div id="ww576458" class="NormalCode">{</div><div id="ww576459" class="NormalCode">    _textField-&gt;draw(dst, t, clip);</div><div id="ww576460" class="NormalCode">    _rightButton-&gt;draw(dst, t, clip);</div><div id="ww576461" class="NormalCode">    _leftButton-&gt;draw(dst, t, clip);</div><div id="ww576462" class="LastNormalCode">}</div><div id="ww576490" class="Heading3"><span></span>Redefining IlvGraphic Member Functions</div><div id="ww579118" class="Body">Several member functions of the <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span> class have been redefined to allow delegation to the components of the composite gadget. The <span class="code">setPalette</span> method is given as an example: </div><div id="ww576491" class="NormalCode">void</div><div id="ww576493" class="NormalCode">UpDownField::setPalette(IlvPalette* palette)</div><div id="ww576494" class="NormalCode">{</div><div id="ww576495" class="NormalCode">    IlvGadget::setPalette(palette);</div><div id="ww576496" class="NormalCode">    _textField-&gt;setPalette(palette);</div><div id="ww576497" class="NormalCode">    _rightButton-&gt;setPalette(palette);</div><div id="ww576498" class="NormalCode">    _leftButton-&gt;setPalette(palette);</div><div id="ww576499" class="LastNormalCode">}</div><div id="ww576501" class="Body">When the palette of <span class="code">UpDownField</span> is changed, the same palette is set to each component of the <span class="code">UpDownField</span>.</div><div id="ww578612" class="Body">Finally, you need to override the <span class="code">setHolder</span> method as follows:</div><div id="ww578619" class="NormalCode">void</div><div id="ww578620" class="NormalCode">UpDownField::setHolder(IlvGraphicHolder* holder)</div><div id="ww578621" class="NormalCode">{</div><div id="ww578622" class="NormalCode">   IlvGadget::setHolder(holder);</div><div id="ww578623" class="NormalCode">   _textField-&gt;setHolder(holder);</div><div id="ww578624" class="NormalCode">   _rightButton-&gt;setHolder(holder);</div><div id="ww578625" class="NormalCode">   _leftButton-&gt;setHolder(holder);</div><div id="ww578626" class="LastNormalCode">}</div><div id="ww578627" class="Body">This method will be called each time <span class="code">UpDownField</span> is added or removed from a holder. It ensures that all the components of <span class="code">UpDownField</span> have the same holder. This is mandatory, as gadgets require a holder to behave properly.</div><div id="ww576328" class="Subhead"><span></span>Handling Keyboard Focus in a Gadget</div><div id="ww579323" class="Body">The main difference between handling events in a graphic and in a gadget class is that a gadget can take the keyboard focus. Once a gadget has the keyboard focus, keyboard events are sent to this gadget. For more details, see “Focus Management” in Gadgets Main Properties.</div><div id="ww576554" class="Body">Handling keyboard focus means: </div><div id="ww576555" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>Reacting to focus events. When a gadget is about to be given the focus, it receives the <span class="code">IlvKeyboardFocusIn</span> event. Similarly, when a gadget is about to lose the focus, it receives the <span class="code">IlvKeyboardFocusOut</span> event.</div><div id="ww576556" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>Handling the drawing of the focus. Two methods are involved in the drawing mechanism of the focus: <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span><span class="code">::computeFocusRegion</span> and <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span><span class="code">::drawFocus</span>. The first method gives information about the location of the focus drawing. The second method draws the focus.</div><div id="ww576557" class="Body">It must be possible to give the focus to each component of <span class="code">UpDownField</span>. When the focus is given to <span class="code">UpDownField</span>, it is forwarded to the component that you chose to have it sent to. A protected member variable is added to keep a pointer to the current focus component of the <span class="code">UpDownField</span>:</div><div id="ww576483" class="NormalCode">protected:</div><div id="ww576487" class="LastNormalCode">   IlvGadget*    _focusGadget;</div><div id="ww576506" class="Body">A method named <span class="code">setFocus</span> is also added to change the current focused object inside <span class="code">UpDownField</span>:</div><div id="ww576489" class="NormalCode">void</div><div id="ww576509" class="NormalCode">UpDownField::setFocus(IlvGadget* gadget)</div><div id="ww576510" class="NormalCode">{</div><div id="ww576511" class="NormalCode">    IlvRegion region;</div><div id="ww576512" class="NormalCode">    // Send a focus_out event to the gadget that loses the focus.</div><div id="ww576513" class="NormalCode">    if (_focusGadget) {</div><div id="ww576514" class="NormalCode">        IlvEvent fo;</div><div id="ww576515" class="NormalCode">        fo._type = IlvKeyboardFocusOut;</div><div id="ww576516" class="NormalCode">        _focusGadget-&gt;computeFocusRegion(region, getTransformer());</div><div id="ww576517" class="NormalCode">        _focusGadget-&gt;handleEvent(fo);</div><div id="ww576518" class="NormalCode">        _focusGadget = 0;</div><div id="ww576519" class="NormalCode">    }</div><div id="ww576520" class="NormalCode">    _focusGadget = gadget;</div><div id="ww576521" class="NormalCode">    // Send a focus_in event to the gadget that receives the focus.</div><div id="ww576522" class="NormalCode">    if (_focusGadget) {</div><div id="ww576523" class="NormalCode">        IlvEvent fi;</div><div id="ww576524" class="NormalCode">        fi._type = IlvKeyboardFocusIn;</div><div id="ww576525" class="NormalCode">        _focusGadget-&gt;handleEvent(fi);</div><div id="ww576526" class="NormalCode">        _focusGadget-&gt;computeFocusRegion(region, getTransformer());</div><div id="ww576527" class="NormalCode">    }</div><div id="ww576528" class="NormalCode">    if (getHolder())</div><div id="ww576529" class="NormalCode">        getHolder()-&gt;reDraw(&amp;region);</div><div id="ww576530" class="LastNormalCode">}</div><div id="ww576538" class="Body">The method first sends an <span class="code">IlvKeyboardFocusOut</span> event to the component that will lose the keyboard focus. Then it sends an <span class="code">IlvKeyboardFocusIn</span> event to the new focused component. Finally, the modified region is redrawn using the <span class="code">IlvGraphicHolder</span> API.</div><div id="ww576560" class="Body">The following shows how the focus is drawn. The <span class="code">computeFocusRegion</span> and <span class="code">drawFocus</span> methods are involved in this process:</div><div id="ww576561" class="NormalCode">void</div><div id="ww576563" class="NormalCode">UpDownField::drawFocus(IlvPort* dst,</div><div id="ww576564" class="NormalCode">                       const IlvPalette* palette,</div><div id="ww576565" class="NormalCode">                       const IlvTransformer* t,</div><div id="ww576566" class="NormalCode">                       const IlvRegion* clip) const</div><div id="ww576567" class="NormalCode">{</div><div id="ww576568" class="NormalCode">    _focusGadget-&gt;drawFocus(dst, palette, t, clip);</div><div id="ww576569" class="NormalCode">}</div><div id="ww576570" class="NormalCode">&nbsp;</div><div id="ww576572" class="NormalCode">void</div><div id="ww576573" class="NormalCode">UpDownField::computeFocusRegion(IlvRegion&amp; region,</div><div id="ww576574" class="NormalCode">                                const IlvTransformer* t) const</div><div id="ww576575" class="NormalCode">{</div><div id="ww576576" class="NormalCode">    _focusGadget-&gt;computeFocusRegion(region, t);</div><div id="ww576577" class="LastNormalCode">}</div><div id="ww576581" class="Body">The <span class="code">UpDownField</span> delegates to the current focused object. The next section shows how to change the keyboard focus of the <span class="code">UpDownField</span>.</div><div id="ww576541" class="Subhead"><span></span>Handling Events in a Gadget</div><div id="ww576549" class="Body">The entry point for events in a gadget class is the <span class="MethodName"><a href="../RefMan/refcppfoundation/classIlvGadget.html#adba5f477b3d4bd6f0a5a5375db270e4b">handleEvent</a></span> method. This method is called by the gadget holder when it receives an event that should be handled by the gadget. The <span class="code">UpDownField::</span><span class="code">handleEvent</span> is very simple, as it delegates most of the events to the focused object (pointed by the <span class="code">_focusGadget</span> member variable):</div><div id="ww576582" class="NormalCode">IlvBoolean</div><div id="ww576584" class="NormalCode">UpDownField::handleEvent(IlvEvent&amp; event)</div><div id="ww576585" class="NormalCode">{</div><div id="ww576586" class="NormalCode">    IlvBoolean result = IlvFalse;</div><div id="ww576591" class="NormalCode">    switch (event.type()) {</div><div id="ww576592" class="NormalCode">    case IlvButtonDown:</div><div id="ww576593" class="NormalCode">        {</div><div id="ww576594" class="NormalCode">            // Changing focus on click</div><div id="ww576595" class="NormalCode">            IlvRect r1, r2, r3;</div><div id="ww576596" class="NormalCode">            IlvPoint evp(event.x(), event.y());</div><div id="ww576597" class="NormalCode">            computeRects(r1, r2, r3,  getTransformer());</div><div id="ww576598" class="NormalCode">            if (r2.contains(evp) &amp;&amp; _focusGadget != _textField)</div><div id="ww576599" class="NormalCode">                setFocus(_textField);</div><div id="ww576600" class="NormalCode">            else</div><div id="ww576601" class="NormalCode">            if (r3.contains(evp) &amp;&amp; _focusGadget != _rightButton)</div><div id="ww576602" class="NormalCode">                setFocus(_rightButton);</div><div id="ww576603" class="NormalCode">            else</div><div id="ww576604" class="NormalCode">            if (r1.contains(evp) &amp;&amp; _focusGadget != _leftButton)</div><div id="ww576605" class="NormalCode">                setFocus(_leftButton);</div><div id="ww576606" class="NormalCode">            result = _focusGadget-&gt;handleEvent(event);</div><div id="ww576607" class="NormalCode">            break;</div><div id="ww576608" class="NormalCode">      }</div><div id="ww576609" class="NormalCode">    case IlvKeyDown:</div><div id="ww576610" class="NormalCode">        {</div><div id="ww576611" class="NormalCode">            // Moving focus with the Tab key.</div><div id="ww576612" class="NormalCode">            if (event.data() == IlvTab &amp;&amp;</div><div id="ww576613" class="NormalCode">                (!(event.modifiers() &amp; IlvShiftModifier)) &amp;&amp;</div><div id="ww576614" class="NormalCode">                (!(event.modifiers() &amp; IlvCtrlModifier))) {</div><div id="ww576620" class="NormalCode">                if (_focusGadget == _textField)</div><div id="ww576621" class="NormalCode">                    setFocus(_rightButton);</div><div id="ww576622" class="NormalCode">                else</div><div id="ww576623" class="NormalCode">                if (_focusGadget == _rightButton)</div><div id="ww576624" class="NormalCode">                    setFocus(_leftButton);</div><div id="ww576625" class="NormalCode">                else</div><div id="ww576626" class="NormalCode">                if (_focusGadget == _leftButton)</div><div id="ww576627" class="NormalCode">                    setFocus(_textField);</div><div id="ww576628" class="NormalCode">                return IlvTrue;</div><div id="ww576629" class="NormalCode">            }</div><div id="ww576630" class="NormalCode">            // Moving focus with the Shift Tab key.</div><div id="ww576631" class="NormalCode">            if (event.data() == IlvTab &amp;&amp;</div><div id="ww576632" class="NormalCode">                ((event.modifiers() &amp; IlvShiftModifier)) &amp;&amp;</div><div id="ww576633" class="NormalCode">                (!(event.modifiers() &amp; IlvCtrlModifier))) {</div><div id="ww576634" class="NormalCode">                if (_focusGadget == _leftButton)</div><div id="ww576635" class="NormalCode">                    setFocus(_rightButton);</div><div id="ww576636" class="NormalCode">                else</div><div id="ww576637" class="NormalCode">                if (_focusGadget == _rightButton)</div><div id="ww576638" class="NormalCode">                    setFocus(_textField);</div><div id="ww576639" class="NormalCode">                else</div><div id="ww576640" class="NormalCode">                if (_focusGadget == _textField)</div><div id="ww576641" class="NormalCode">                    setFocus(_leftButton);</div><div id="ww576642" class="NormalCode">                return IlvTrue;</div><div id="ww576643" class="NormalCode">            }</div><div id="ww576644" class="NormalCode">        }</div><div id="ww576645" class="NormalCode">    default:</div><div id="ww576646" class="NormalCode">        result = _focusGadget-&gt;handleEvent(event);</div><div id="ww576647" class="NormalCode">    }</div><div id="ww576648" class="NormalCode">    return result;</div><div id="ww576649" class="LastNormalCode">}</div><div id="ww576671" class="Body">The main part of the <span class="code">handleEvent</span> method deals with keyboard focus management. The <span class="code">IlvButtonDown</span> case is responsible for changing the current focused object when a button down event is received by the composite gadget. The <span class="code">IlvKeyDown</span> case is responsible for changing the current focus object when a TAB key or Shift-TAB key event is received by the composite gadget. The default case simply delegates to the current focused object.</div><div id="ww576325" class="Subhead"><span></span>Adding Callbacks to a Gadget</div><div id="ww576672" class="Body">As shown at the beginning of this step, the left and right buttons of <span class="code">UpDownField</span> are assigned a callback to allow user notification when pressed. Two callbacks are now defined: a <span class="code">Down</span> callback, which will be called each time the left button is pressed, and an <span class="code">Up</span> callback, which will be called each time the right button is pressed.</div><div id="ww576673" class="Body">These callbacks are declared in the <span class="code">getCallbackType</span> method:</div><div id="ww576674" class="NormalCode">IlvUInt</div><div id="ww576676" class="NormalCode">UpDownField::getCallbackTypes(const char* const**      names,</div><div id="ww576677" class="NormalCode">                              const IlvSymbol* const** types) const</div><div id="ww576678" class="NormalCode">{</div><div id="ww576679" class="NormalCode">    IlvUInt count = IlvGadget::getCallbackTypes(names, types);</div><div id="ww576680" class="NormalCode">    AddToCallbackTypeList(count, names, types,</div><div id="ww576681" class="NormalCode">                          "Down", downCallbackType());</div><div id="ww576682" class="NormalCode">    AddToCallbackTypeList(count, names, types,</div><div id="ww576683" class="NormalCode">                          "Up", upCallbackType());</div><div id="ww576684" class="NormalCode">    return count;</div><div id="ww576685" class="LastNormalCode">}</div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww578589" class="Note"><span class="flag">Note:&nbsp;</span>Redefining this method is not mandatory, but will allow easier integration of the <span class="code">UpDownField</span> in an editor (such as Rogue Wave&nbsp;Views Studio), since it will be possible for the editor to query the list of callbacks handled by the <span class="code">UpDownField</span>.</div></td></tr></table></div><div id="ww576693" class="Body">Then, the <span class="code">UpDownField::</span><span class="code">increment</span> method is implemented to call the <span class="code">Up</span> callback and the <span class="code">UpDownField::</span><span class="code">decrement</span> method is implemented to call the <span class="code">Down</span> callback:</div><div id="ww576688" class="NormalCode">void</div><div id="ww576700" class="NormalCode">UpDownField::increment()</div><div id="ww576701" class="NormalCode">{</div><div id="ww576702" class="NormalCode">    callCallbacks(upCallbackType());</div><div id="ww576703" class="NormalCode">}</div><div id="ww576704" class="NormalCode">&nbsp;</div><div id="ww576706" class="NormalCode">void</div><div id="ww576707" class="NormalCode">UpDownField::decrement()</div><div id="ww576708" class="NormalCode">{</div><div id="ww576709" class="NormalCode">    callCallbacks(downCallbackType());</div><div id="ww576710" class="LastNormalCode">}</div><div id="ww578630" class="Subhead"><span></span>Testing the Composite Gadget</div><div id="ww578631" class="Body">The file <span class="code">main.cpp</span> contains the code to test the <span class="code">UpDownField</span> class. It shows how to implement the <span class="code">Up</span> and <span class="code">Down</span> callbacks of the <span class="code">UpDownField</span> class to change the value of the text field—the <span class="code">Down</span> callback will decrement the text field value, while the <span class="code">Up</span> callback will increment it.</div><div id="ww578632" class="Body">First, a container is created and an instance of the <span class="code">UpDownField</span> class is added to it.</div><div id="ww578633" class="NormalCode">IlvDialog* dialog = new IlvDialog(display,</div><div id="ww578857" class="NormalCode">                                  title,</div><div id="ww578858" class="NormalCode">                                  title,</div><div id="ww578634" class="NormalCode">                                  IlvRect(0, 0, 100, 100));</div><div id="ww578635" class="NormalCode">UpDownField* but = new UpDownField(display, IlvRect(5, 5, 100, 23) , "0");</div><div id="ww578636" class="LastNormalCode">dialog-&gt;addObject(but);</div><div id="ww578638" class="Body">Then, the callbacks of the <span class="code">UpDownField</span> are set:</div><div id="ww578639" class="NormalCode">but-&gt;setUpCallback(Increment);</div><div id="ww578640" class="LastNormalCode">but-&gt;setDownCallback(Decrement);</div><div id="ww578641" class="Body">Here is the implementation of the callbacks:</div><div id="ww578642" class="NormalCode">static void Increment(IlvGraphic* g, IlvAny)</div><div id="ww578643" class="NormalCode">{</div><div id="ww578644" class="NormalCode">    char buffer[1000];</div><div id="ww578645" class="NormalCode">    UpDownField * obj = (UpDownField*)g;</div><div id="ww578646" class="NormalCode">    const char* label = obj-&gt;getLabel();</div><div id="ww578647" class="NormalCode">    if (label &amp;&amp; *label) {</div><div id="ww578648" class="NormalCode">        IlvInt value = ((IlvInt)atof(label))+1;</div><div id="ww578649" class="NormalCode">        sprintf(buffer, "%ld", value);</div><div id="ww578650" class="NormalCode">        obj-&gt;setLabel(buffer, IlvTrue);</div><div id="ww578651" class="NormalCode">    } else</div><div id="ww578652" class="NormalCode">        obj-&gt;setLabel("0", IlvTrue);</div><div id="ww578653" class="NormalCode">}</div><div id="ww578654" class="NormalCode">&nbsp;</div><div id="ww578655" class="NormalCode">static void Decrement(IlvGraphic* g, IlvAny)</div><div id="ww578656" class="NormalCode">{</div><div id="ww578657" class="NormalCode">    char buffer[1000];</div><div id="ww578658" class="NormalCode">    UpDownField * obj = (UpDownField*)g;</div><div id="ww578659" class="NormalCode">    const char* label = obj-&gt;getLabel();</div><div id="ww578660" class="NormalCode">    if (label &amp;&amp; *label) {</div><div id="ww578661" class="NormalCode">        IlvInt value = ((IlvInt)atof(label))-1;</div><div id="ww578662" class="NormalCode">        sprintf(buffer, "%ld", value);</div><div id="ww578663" class="NormalCode">        obj-&gt;setLabel(buffer, IlvTrue);</div><div id="ww578664" class="NormalCode">    } else</div><div id="ww578665" class="NormalCode">        obj-&gt;setLabel("0", IlvTrue);</div><div id="ww578666" class="LastNormalCode">}</div><div id="ww578668" class="Body">These callbacks retrieve the text field value of the <span class="code">UpDownField</span> instance by calling <span class="code">UpDownField::</span><span class="code">getLabel</span>, modify it by adding or removing the value 1, and set it as the label of the text field by calling <span class="code">UpDownField::</span><span class="code">setLabel</span>.</div><div id="ww578669" class="Body">This is the end of Step 3.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>