<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Step 4: Adding a Custom Event to the ActiveX Control</title><link rel="Prev" href="viewstoocx.02.10.html" title="Previous" /><link rel="Next" href="activexgraphic.03.1.html" title="Next" /><link rel="StyleSheet" href="css/viewstoocx.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/viewstoocx_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Tutorials/viewstoocx.02.11.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="peKpWNluD3dsvk0jpmu533g" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Tutorials/viewstoocx.02.11.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/foundtutfrontcover.html#wwconnect_header">Views Foundation</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/viewstoocx.02.01.html#wwconnect_header">Creating an ActiveX Control from Existing Rogue Wave&nbsp;Views Code</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/viewstoocx.02.07.html#wwconnect_header">Creating an ActiveX Control with the MFC Library</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Step 4: Adding a Custom Event to the ActiveX Control</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww1002384" class="Heading2"><span></span>Step 4: Adding a Custom Event to the ActiveX Control</div><div id="ww1002385" class="Body">This step demonstrates how to add a custom event (<span class="code">PointerPosition</span>) to the ActiveX control. Each time the user moves the mouse pointer, the member function <span class="code">handleEvent</span> of the view interactor will fire the event and send it to the container. This event has three parameters: </div><div id="ww1002386" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>A <span class="code">BSTR</span> parameter, which represents the name of the object underneath the mouse, if any.</div><div id="ww1002387" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">OLE_XPOS_PIXELS</span> and <span class="code">OLE_YPOS_PIXELS</span> parameters, which represent the position of the mouse relative to the <span class="code">IlvManagerView</span>. </div><div id="ww1007500" class="Body">You are going to:</div><div id="ww1007501" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002388" title="Step 4: Adding a Custom Event to the ActiveX Control">Define the new custom event.</a></div><div id="ww1007511" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002404" title="Step 4: Adding a Custom Event to the ActiveX Control">Modify the member function CDemoMFCCtrl::onCreate.</a></div><div id="ww1007516" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1004071" title="Step 4: Adding a Custom Event to the ActiveX Control">Define the class TrackInteractor.</a></div><div id="ww1007521" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002436" title="Step 4: Adding a Custom Event to the ActiveX Control">Add the private m_Inter variable to the DemoCtrl class.</a></div><div id="ww1007526" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1005588" title="Step 4: Adding a Custom Event to the ActiveX Control">Declare the class TrackInteractor as a friend of the class CDemoMFCCtrl (in the file DemoMFCCtl.h).</a></div><div id="ww1007531" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002438" title="Step 4: Adding a Custom Event to the ActiveX Control">Initialize the m_Inter variable in the DemoCtrl constructor and attach it to the view through the manager.</a></div><div id="ww1007536" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002446" title="Step 4: Adding a Custom Event to the ActiveX Control">Modify the destructor to delete the interactor stored in m_Inter.</a></div><div id="ww1007541" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/viewstoocx.02.11.html#ww1002457" title="Step 4: Adding a Custom Event to the ActiveX Control">Test the properties.</a></div><div id="ww1002388" class="Heading4">Define the new custom event. </div><div id="ww1002389" class="Numbered1"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">1.	</span></span>In the ClassView tab of the Project Workspace window click the <span class="code">DemoMFCCtrl</span> interface with the right mouse button. </div><div id="ww1002390" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">2.	</span></span>Choose Add &gt; Add Event from the menu that appears. </div><div id="ww1002391" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">3.	</span></span>In the dialog box, enter the following values: </div><div id="ww1012924" class="Bulleted"><span class="WebWorks_Number" style="width: 11.338582677165192pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">PointerPosition</span> in <span class="code">Event Name</span>,</div><div id="ww1012928" class="Bulleted"><span class="WebWorks_Number" style="width: 11.338582677165192pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>FirePointerPosition in <span class="code">Internal Name</span>,</div><div id="ww1012929" class="Bulleted"><span class="WebWorks_Number" style="width: 11.338582677165192pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">BSTR</span> <span class="code">name</span>, <span class="code">OLE_XPOS_PIXELS x</span>, <span class="code">OLE_YPOS_PIXELS y</span> as the parameters.</div><div id="ww1012962" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">4.	</span></span>Rebuild your project.</div><div id="ww1012978" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">5.	</span></span>In <span class="code">DemoMFCCtrl.h</span>, check that the <span class="code">FirePointerPosition</span> method is declared as public and that its first parameter is typed as <span class="code">BSTR</span>.</div><div id="ww1002399" class="Heading4">Modify the constructor of the class DemoCtrl. </div><div id="ww1002400" class="Body">Modify this constructor so that it accepts a reference to the class <span class="code">CDemoMFCCtrl</span> as its second parameter. Add a forward declaration for the class <span class="code">CDemoMFCCtrl</span> to the file <span class="code">DemoCtrl.h</span> and include the files <span class="code">stdafx.h</span>, <span class="code">DemoMFC.h</span>, and <span class="code">DemoMFCCtl.h</span> into the file <span class="code">DemoCtrl.cpp</span>. </div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1002403" class="Note"><span class="flag">Note:&nbsp;</span>You must include these files before the Rogue Wave&nbsp;Views header files.</div></td></tr></table></div><div id="ww1002404" class="Heading4">Modify the member function CDemoMFCCtrl::onCreate.</div><div id="ww1002405" class="Body">In the member function <span class="code">CDemoMFCCtrl::OnCreate </span>(file <span class="code">DemoMFCCtl.cpp</span>), add <span class="code">*this</span> as the second parameter to the call to the <span class="code">DemoCtrl</span> constructor. </div><div id="ww1004071" class="Heading4">Define the class TrackInteractor. </div><div id="ww1002406" class="Body">In the file <span class="code">DemoCtrl.cpp</span>, define a new class <span class="code">TrackInteractor</span> deriving from <span class="code">IlvViewManagerInteractor</span>: </div><div id="ww1003315" class="NormalCode">class TrackInteractor : public IlvManagerViewInteractor</div><div id="ww1003316" class="NormalCode">{</div><div id="ww1003317" class="NormalCode">public:</div><div id="ww1003318" class="NormalCode">    TrackInteractor(IlvManager* m, IlvView* v, CDemoMFCCtrl&amp; MFCCtrl)</div><div id="ww1003319" class="NormalCode">    : IlvManagerViewInteractor(m, v), m_MFCCtrl(MFCCtrl)</div><div id="ww1003320" class="NormalCode">    {</div><div id="ww1003321" class="NormalCode">    }</div><div id="ww1003322" class="NormalCode">    ~TrackInteractor() {}</div><div id="ww1013916" class="NormalCode">&nbsp;&nbsp;&nbsp;&nbsp;IlBoolean handleEvent(IlvEvent&amp; event)</div><div id="ww1013917" class="NormalCode">    {</div><div id="ww1013918" class="NormalCode">        IlBoolean consumed = IlFalse;</div><div id="ww1013919" class="NormalCode">        if (event.getType() == IlvPointerMoved) {</div><div id="ww1013920" class="NormalCode">            consumed = IlTrue;</div><div id="ww1013921" class="NormalCode">            IlvGraphic* obj =</div><div id="ww1013922" class="NormalCode">            getManager()-&gt;lastContains(IlvPoint(event.x(), event.y()), </div><div id="ww1013923" class="NormalCode">                                       getView());</div><div id="ww1013924" class="NormalCode">            CString mfcName;</div><div id="ww1013925" class="NormalCode">            if (obj) {</div><div id="ww1013926" class="NormalCode">                const char* name = getManager()-&gt;getObjectName(obj);</div><div id="ww1013927" class="NormalCode">                mfcName = name;</div><div id="ww1013928" class="NormalCode">            }</div><div id="ww1013929" class="NormalCode">            BSTR bstrName = mfcName.AllocSysString();</div><div id="ww1013930" class="NormalCode">            m_MFCCtrl.FirePointerPosition(&amp;bstrName,</div><div id="ww1013931" class="NormalCode">                                          OLE_XPOS_PIXELS(event.x()),</div><div id="ww1013932" class="NormalCode">                                          OLE_XPOS_PIXELS(event.y()));</div><div id="ww1013933" class="NormalCode">            ::SysFreeString(bstrName);</div><div id="ww1013934" class="NormalCode">        }</div><div id="ww1013935" class="NormalCode">        if (!getManager()-&gt;dispatchToObjects(event, getView())) {</div><div id="ww1013936" class="NormalCode">            consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww1013937" class="NormalCode">        } else {</div><div id="ww1013938" class="NormalCode">            consumed = IlTrue;</div><div id="ww1013939" class="NormalCode">        }</div><div id="ww1013940" class="NormalCode">        return consumed;</div><div id="ww1003323" class="NormalCode">    }</div><div id="ww1003343" class="NormalCode">private:</div><div id="ww1003344" class="NormalCode">    CDemoMFCCtrl&amp; m_MFCCtrl;</div><div id="ww1002435" class="LastNormalCode">};</div><div id="ww1002436" class="Heading4">Add the private m_Inter variable to the DemoCtrl class.</div><div id="ww1002437" class="Body">To add this variable you can use the wizard as explained in <span class="Emphasis" style="font-style: italic"><a href="../Tutorials/viewstoocx.02.10.html#ww1002187" title="Step 3: Adding Custom Properties to the ActiveX Control">Step 3: Adding Custom Properties to the ActiveX Control</a></span>. Do not forget to include a forward declaration for the <span class="code">TrackInteractor</span> class in the <span class="code">DemoCtrl.h</span> file. </div><div id="ww1005588" class="Heading4">Declare the class TrackInteractor as a friend of the class CDemoMFCCtrl (in the file DemoMFCCtl.h). </div><div id="ww1002438" class="Heading4">Initialize the m_Inter variable in the DemoCtrl constructor and attach it to the view through the manager. </div><div id="ww1004109" class="NormalCode">DemoCtrl::DemoCtrl(HWND hWnd, CDemoMFCCtrl&amp; MFCCtrl)</div><div id="ww1004110" class="NormalCode">: Ctrl(_Display, reinterpret_cast&lt;IlvSystemView&gt;(hWnd)), m_Inter(0)</div><div id="ww1004111" class="NormalCode">{</div><div id="ww1004112" class="NormalCode">    m_Inter = new TrackInteractor(getManager(), getManagerView(), MFCCtrl);</div><div id="ww1004113" class="NormalCode">    getManager()-&gt;setInteractor(m_Inter, getManagerView());</div><div id="ww1002444" class="LastNormalCode">}</div><div id="ww1002446" class="Heading4">Modify the destructor to delete the interactor stored in m_Inter. </div><div id="ww1002447" class="NormalCode">DemoCtrl::~DemoCtrl()</div><div id="ww1002448" class="NormalCode">{</div><div id="ww1002449" class="NormalCode">    if (m_Inter) {</div><div id="ww1002450" class="NormalCode">        getManager()-&gt;setInteractor(0, getManagerView());</div><div id="ww1002451" class="NormalCode">        delete m_Inter;</div><div id="ww1002452" class="NormalCode">         m_Inter = 0;</div><div id="ww1002453" class="NormalCode">    }</div><div id="ww1002454" class="NormalCode">&nbsp;</div><div id="ww1002455" class="LastNormalCode">}</div><div id="ww1002457" class="Heading4">Test the properties.</div><div id="ww1002460" class="Body">The function <span class="code">DemoMFCCtrl_PointerPosition</span> is called each time a <span class="code">PointerPosition</span> event is fired. It displays the coordinates of the object which the mouse is over, if any, and its name, if defined: </div><div id="ww1003480" class="NormalCode">&lt;HTML&gt;</div><div id="ww1003481" class="NormalCode">&lt;HEAD&gt;</div><div id="ww1003482" class="NormalCode">&lt;TITLE&gt;Test page for object DemoMFCCtl&lt;/TITLE&gt;</div><div id="ww1003483" class="NormalCode">&lt;/HEAD&gt;</div><div id="ww1003484" class="NormalCode">&nbsp;</div><div id="ww1003485" class="NormalCode">&lt;SCRIPT LANGUAGE = "javascript"&gt;</div><div id="ww1003486" class="NormalCode">&nbsp;</div><div id="ww1003487" class="NormalCode">&lt;!--</div><div id="ww1003488" class="NormalCode">function load(value)</div><div id="ww1003489" class="NormalCode">{</div><div id="ww1003490" class="NormalCode">&nbsp;&nbsp;&nbsp;&nbsp;DemoMFCCtrl.FileName = value;</div><div id="ww1003491" class="NormalCode">}</div><div id="ww1003492" class="NormalCode">&nbsp;</div><div id="ww1003493" class="NormalCode">--&gt;</div><div id="ww1003494" class="NormalCode">&lt;/SCRIPT&gt;</div><div id="ww1003495" class="NormalCode">&nbsp;</div><div id="ww1003496" class="NormalCode">&lt;SCRIPT LANGUAGE = "VBScript"&gt;</div><div id="ww1003497" class="NormalCode">&nbsp;</div><div id="ww1003498" class="NormalCode">&lt;!--</div><div id="ww1003499" class="NormalCode">Sub DemoMFCCtrl_PointerPosition(name, x, y)</div><div id="ww1003500" class="NormalCode">    text1.innerText = name &amp; " (" &amp; x &amp; ", " &amp; y &amp; ")"</div><div id="ww1003501" class="NormalCode">End Sub</div><div id="ww1003502" class="NormalCode">&nbsp;</div><div id="ww1003503" class="NormalCode">--&gt;</div><div id="ww1003504" class="NormalCode">&lt;/SCRIPT&gt;</div><div id="ww1003505" class="NormalCode">&nbsp;</div><div id="ww1003506" class="NormalCode">&lt;BODY&gt;</div><div id="ww1003513" class="NormalCode">&nbsp;</div><div id="ww1003514" class="NormalCode">&lt;P&gt;</div><div id="ww1003515" class="NormalCode">&lt;OBJECT WIDTH=400 HEIGHT=400 ID="DemoMFCCtrl" CLASSID="CLSID:3D31E7B8-400B-</div><div id="ww1005332" class="NormalCode">11D3-B74F-00C04F68A89D"&gt;&lt;/OBJECT&gt;</div><div id="ww1003516" class="NormalCode">&lt;P&gt;</div><div id="ww1003517" class="NormalCode">&nbsp;</div><div id="ww1003518" class="NormalCode">&lt;INPUT id=text1 name=text1&gt;</div><div id="ww1003519" class="NormalCode">&lt;/P&gt;</div><div id="ww1003520" class="NormalCode">&nbsp;</div><div id="ww1003521" class="NormalCode">&lt;/BODY&gt;</div><div id="ww1003522" class="NormalCode">&nbsp;</div><div id="ww1003476" class="LastNormalCode">&lt;/HTML&gt;</div><div class="ww_skin_page_overflow"><table class="NoteTable" cellspacing="0" summary=""><tr><td style="padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top"><div id="ww1006030" class="Note"><span class="flag">Note:&nbsp;</span>Since the class id is generated, the class id in your file may be different from the one in this example. </div></td></tr></table></div><div id="ww1002505" class="Body">See the project <span class="code">VB/testMFC.vbp</span> for an example of how to run a test via Visual Basic. The function <span class="code">DemoMFCCtrl1_PointerPosition</span> is called each time a <span class="code">PointerPosition</span> event is fired. </div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>