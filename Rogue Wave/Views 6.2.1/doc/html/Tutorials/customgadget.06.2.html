<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Step 1: Extending a Gadget by Changing its Graphical Appearance</title><link rel="Prev" href="customgadget.06.1.html" title="Previous" /><link rel="Next" href="customgadget.06.3.html" title="Next" /><link rel="StyleSheet" href="css/customgadget.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/customgadget_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Tutorials/customgadget.06.2.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pjXQA8_002fUfPHwU193oZlvw8w" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Tutorials/customgadget.06.2.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/gadgtutfrontcover.html#wwconnect_header">Gadgets</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Tutorials/customgadget.06.1.html#wwconnect_header">Customizing Gadgets</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Step 1: Extending a Gadget by Changing its Graphical Appearance</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww577482" class="Heading1"><span></span>Step 1: Extending a Gadget by Changing its Graphical Appearance</div><div id="ww577483" class="Body">This first step describes how to create a subclass of an existing gadget to change its graphical appearance.</div><div id="ww574961" class="Body">In this step the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> class will be extended. Its drawing will be modified to allow the user to change the color of the children of an item, as shown in the following figure:</div><div class="ww_skin_page_overflow"><div id="ww574962" class="Startplain"><img class="Default" src="../Tutorials/images/coltree.png" width="100%" style="display: block; left: 0.0pt; max-height: 291px; max-width: 371px; top: 0.0pt" alt="" /></div></div><div id="ww574959" class="Body">This step shows you how to perform the following tasks:</div><div id="ww574994" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.2.html#ww574960" title="Step 1: Extending a Gadget by Changing its Graphical Appearance">Creating a Subclass of an Existing Gadget</a></div><div id="ww574993" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.2.html#ww574997" title="Step 1: Extending a Gadget by Changing its Graphical Appearance">Adding an API to the New Gadget Class</a></div><div id="ww574995" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.2.html#ww574998" title="Step 1: Extending a Gadget by Changing its Graphical Appearance">Modifying How the New Gadget is Drawn</a></div><div id="ww574996" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Tutorials/customgadget.06.2.html#ww575000" title="Step 1: Extending a Gadget by Changing its Graphical Appearance">Testing the New Gadget Class</a></div><div id="ww574960" class="Subhead"><span></span>Creating a Subclass of an Existing Gadget</div><div id="ww575002" class="Body">Creating a new subclass of an existing gadget is similar to creating a subclass of any existing <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span> class. The main steps to properly create a subclass of an <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span> object are described here.</div><div id="ww578936" class="Heading3"><span></span>Declare the Subclass</div><div id="ww575006" class="Body">Declare your subclass as a subclass of the chosen graphic. In this tutorial, <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> is subclassed to create a new object that can display colored items. This subclass will be called <span class="code">ColoredTreeGadget</span>. Here is the declaration of the <span class="code">ColoredTreeGadget</span> class:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580275" class="CodeInTable">class ColoredTreeGadget</div><div id="ww580276" class="CodeInTable">: public IlvTreeGadget {</div><div id="ww580277" class="CodeInTable">public:</div><div id="ww580278" class="CodeInTable">    ColoredTreeGadget(IlvDisplay*        display,</div><div id="ww580279" class="CodeInTable">                      const IlvRect&amp;     rect,</div><div id="ww580280" class="CodeInTable">                      IlvUShort          thickness = IlvDefaultGadgetThickness,</div><div id="ww580281" class="CodeInTable">                      IlvPalette*        palette   = 0);</div><div id="ww580282" class="CodeInTable">    virtual ~ColoredTreeGadget();</div><div id="ww580283" class="CodeInTable">};</div></td></tr></table></div><div id="ww575039" class="Body">This declaration is made up of a constructor and the destructor of the <span class="code">ColoredTreeGadget</span> class.</div><div id="ww575048" class="Body">Add the registration of the <span class="code">ColoredTreeGadget</span> to allow dynamic typing as well as persistence:</div><div id="ww575049" class="NormalCode">DeclareTypeInfo();</div><div id="ww577521" class="NormalCode">DeclareIOConstructors(ColoredTreeGadget);</div><div id="ww577522" class="LastNormalCode">DeclareGraphicAccessors();</div><div id="ww577523" class="Body">The <span class="code">DeclareGraphicAccessors</span> macro declares the <span class="code">queryValue</span> and <span class="code">applyValue</span> methods to allow the new object to be scriptable.</div><div id="ww578941" class="Heading3"><span></span>Implement the Methods</div><div id="ww575063" class="Body">The implementation of the <span class="code">ColoredTreeGadget</span> methods that have been declared is shown here.</div><div id="ww575066" class="Body">First, the constructor is implemented as follows:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580303" class="CodeInTable">ColoredTreeGadget::ColoredTreeGadget(IlvDisplay*        display,</div><div id="ww580304" class="CodeInTable">                                     const IlvRect&amp;     rect,</div><div id="ww580305" class="CodeInTable">                                     IlvUShort          thickness,</div><div id="ww580306" class="CodeInTable">                                     IlvPalette*        palette)</div><div id="ww580307" class="CodeInTable">: IlvTreeGadget(display, rect, thickness, palette)</div><div id="ww580308" class="CodeInTable">{</div><div id="ww580299" class="CodeInTable">}</div></td></tr></table></div><div id="ww575100" class="Body">The copy constructor, declared by the <span class="code">DeclareIOContructors</span> macro:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580324" class="CodeInTable">ColoredTreeGadget::ColoredTreeGadget(const ColoredTreeGadget&amp; source)</div><div id="ww580325" class="CodeInTable">: IlvTreeGadget(source)</div><div id="ww580326" class="CodeInTable">{</div><div id="ww580320" class="CodeInTable">}</div></td></tr></table></div><div id="ww575139" class="Body">Then, the IO constructor, also declared by the <span class="code">DeclareIOConstructors</span> macro:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580338" class="CodeInTable">ColoredTreeGadget::ColoredTreeGadget(IlvInputFile&amp; is, IlvPalette* palette)</div><div id="ww580339" class="CodeInTable">: IlvTreeGadget(is, palette)</div><div id="ww580340" class="CodeInTable">{</div><div id="ww580334" class="CodeInTable">}</div></td></tr></table></div><div id="ww575132" class="Body">The <span class="code">write</span> method, declared by the <span class="code">DeclareTypeInfo</span> macro:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580352" class="CodeInTable">void</div><div id="ww580353" class="CodeInTable">ColoredTreeGadget::write(IlvOutputFile&amp; os) const</div><div id="ww580354" class="CodeInTable">{</div><div id="ww580355" class="CodeInTable">    IlvTreeGadget::write(os);</div><div id="ww580348" class="CodeInTable">}</div></td></tr></table></div><div id="ww575153" class="Body">The destructor:</div><div id="ww575154" class="NormalCode">ColoredTreeGadget::~ColoredTreeGadget()</div><div id="ww575156" class="NormalCode">{</div><div id="ww575157" class="LastNormalCode">}</div><div id="ww575201" class="Body">The accessor related methods, declared by the <span class="code">DeclareGraphicAccessors</span> macro:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580367" class="CodeInTable">IlvValue&amp;</div><div id="ww580368" class="CodeInTable">ColoredTreeGadget::queryValue(IlvValue&amp; value) const</div><div id="ww580369" class="CodeInTable">{</div><div id="ww580370" class="CodeInTable">    return IlvTreeGadget::queryValue(value);</div><div id="ww580371" class="CodeInTable">}</div><div id="ww580372" class="CodeInTable">&nbsp;</div><div id="ww580373" class="CodeInTable">IlvBoolean</div><div id="ww580374" class="CodeInTable">ColoredTreeGadget::applyValue(const IlvValue&amp; value)</div><div id="ww580375" class="CodeInTable">{</div><div id="ww580376" class="CodeInTable">    return IlvTreeGadget::applyValue(value);</div><div id="ww580377" class="CodeInTable">}</div><div id="ww580378" class="CodeInTable">&nbsp;</div><div id="ww580379" class="CodeInTable">void</div><div id="ww580380" class="CodeInTable">ColoredTreeGadget::GetAccessors(const IlvSymbol* const** a,</div><div id="ww580381" class="CodeInTable">                                const IlvValueTypeClass* const** t,</div><div id="ww580382" class="CodeInTable">                                IlvUInt&amp; c)</div><div id="ww580383" class="CodeInTable">{</div><div id="ww580363" class="CodeInTable">}</div></td></tr></table></div><div id="ww575214" class="Body">Then, the implementation of the <span class="code">copy</span> and <span class="code">read</span> methods are given by the <span class="code">IlvPredefinedIOMembers</span> macro:</div><div id="ww575217" class="LastNormalCode">IlvPredefinedIOMembers(ColoredTreeGadget)</div><div id="ww575221" class="Body">Finally, the class is registered as a subclass of the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> class:</div><div id="ww575222" class="LastNormalCode">IlvRegisterClass(ColoredTreeGadget, IlvTreeGadget);</div><div id="ww575225" class="Body">These items are necessary to properly register the <span class="code">ColoredTreeGadget</span> class. Although many of these methods are empty, they will be filled in the next tasks.</div><div id="ww574997" class="Subhead"><span></span>Adding an API to the New Gadget Class</div><div id="ww575003" class="Body">The declaration of the <span class="code">ColoredTreeGadget</span> class can be found in the <span class="code">coltree.h</span> file, and its implementation can be found in the <span class="code">coltree.cpp</span> file.</div><div id="ww575230" class="Body">The <span class="code">ColoredTreeGadget</span> class requires the following:</div><div id="ww575231" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>A way to associate a tree item with a specific color. This color will be used to draw the background of the children of this item.</div><div id="ww575232" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>A way to enable or disable the coloring of the tree items.</div><div id="ww578958" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>Adding accessors to it.</div><div id="ww578959" class="Heading3"><span></span>Associating an Item With a Color</div><div id="ww575236" class="Body">In order to associate a tree item with a color, the <span class="code">setChildrenBackground</span> method has been added. It uses a property set on the tree item to store the color:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580395" class="CodeInTable">void</div><div id="ww580396" class="CodeInTable">ColoredTreeGadget::setChildrenBackground(IlvTreeGadgetItem* item,</div><div id="ww580397" class="CodeInTable">                                         IlvColor* color,</div><div id="ww580398" class="CodeInTable">                                         IlvBoolean redraw)</div><div id="ww580399" class="CodeInTable">{</div><div id="ww580400" class="CodeInTable">    // Retrieve the old color.</div><div id="ww580401" class="CodeInTable">    IlvPalette* oldPalette =</div><div id="ww580402" class="CodeInTable">                 (IlvPalette*)item-&gt;getProperty(GetChildrenBackgroundSymbol());</div><div id="ww580403" class="CodeInTable">    // Compute the new color.</div><div id="ww580404" class="CodeInTable">    IlvPalette* palette = color</div><div id="ww580405" class="CodeInTable">                          ? getDisplay()-&gt;getPalette(0, color)</div><div id="ww580406" class="CodeInTable">                          : 0;</div><div id="ww580407" class="CodeInTable">    // Lock it.</div><div id="ww580408" class="CodeInTable">    if (palette)</div><div id="ww580409" class="CodeInTable">        palette-&gt;lock();</div><div id="ww580410" class="CodeInTable">    // Unlock the old one.</div><div id="ww580411" class="CodeInTable">    if (oldPalette)</div><div id="ww580412" class="CodeInTable">        oldPalette-&gt;unLock();</div><div id="ww580413" class="CodeInTable">    // Set the property to the item.</div><div id="ww580414" class="CodeInTable">    item-&gt;setProperty(GetChildrenBackgroundSymbol(), (IlvAny)palette);</div><div id="ww580415" class="CodeInTable">    // Redraw if asked.</div><div id="ww580416" class="CodeInTable">    if (redraw)</div><div id="ww580417" class="CodeInTable">        reDraw();</div><div id="ww580391" class="CodeInTable">}</div></td></tr></table></div><div id="ww575262" class="Body">The <span class="code">GetChildrenBackgroundSymbol</span> static method returns a symbol that identifies the property set on the item. Its definition is simple:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580433" class="CodeInTable">static IlvSymbol*</div><div id="ww580434" class="CodeInTable">GetChildrenBackgroundSymbol()</div><div id="ww580435" class="CodeInTable">{</div><div id="ww580436" class="CodeInTable">    // This symbol is used to connect a tree gadget item to the color of its</div><div id="ww580437" class="CodeInTable">    // children.</div><div id="ww580438" class="CodeInTable">    static IlvSymbol* symbol = IlvGetSymbol("ChildrenBackground");</div><div id="ww580439" class="CodeInTable">    return symbol;</div><div id="ww580429" class="CodeInTable">}</div></td></tr></table></div><div id="ww575274" class="Body">The <span class="code">getChildrenBackground</span> method returns the color associated with a given tree item.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580460" class="CodeInTable">IlvColor*</div><div id="ww580461" class="CodeInTable">ColoredTreeGadget::getChildrenBackground(const IlvTreeGadgetItem* item) const</div><div id="ww580462" class="CodeInTable">{</div><div id="ww580463" class="CodeInTable">    // Returns the color stored in the property list of the specified item.</div><div id="ww580464" class="CodeInTable">    IlvPalette* palette =</div><div id="ww580465" class="CodeInTable">        (IlvPalette*)item-&gt;getProperty(GetChildrenBackgroundSymbol());</div><div id="ww580466" class="CodeInTable">    return palette</div><div id="ww580467" class="CodeInTable">           ? palette-&gt;getForeground()</div><div id="ww580468" class="CodeInTable">           : 0;</div><div id="ww580456" class="CodeInTable">}</div></td></tr></table></div><div id="ww578966" class="Heading3"><span></span>Enable/Disable the Coloring</div><div id="ww575381" class="Body">The code that will allow the user to enable or disable the coloring of a tree item must be implemented. To do this, a protected member variable is added to the <span class="code">ColoredTreeGadget</span> class:</div><div id="ww575388" class="NormalCode">protected:</div><div id="ww575390" class="LastNormalCode">    IlvBoolean _drawChildrenBg;</div><div id="ww575392" class="Body">This Boolean value will be initialized by the constructors to <span class="code">IlvTrue</span> by default. Here are the member functions that give access to the <span class="code">_drawChildrenBg</span> member variable:</div><div id="ww575393" class="NormalCode">IlvBoolean isDrawingChildrenBackground() const;</div><div id="ww575395" class="NormalCode">void drawChildrenBackground(IlvBoolean value,</div><div id="ww575396" class="LastNormalCode">                            IlvBoolean redraw = IlvTrue);</div><div id="ww578395" class="Body">Since the <span class="code">_drawChildrenBg</span> member variable must be saved, both the IO constructor and the <span class="code">write</span> method must be modified:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580484" class="CodeInTable">ColoredTreeGadget::ColoredTreeGadget(IlvInputFile&amp; is, IlvPalette* palette)</div><div id="ww580485" class="CodeInTable">: IlvTreeGadget(is, palette),</div><div id="ww580486" class="CodeInTable">  _drawChildrenBg(IlvTrue)</div><div id="ww580487" class="CodeInTable">{</div><div id="ww580488" class="CodeInTable">    // Read the _drawChildrenBg flag.</div><div id="ww580489" class="CodeInTable">    int drawChildrenBg;</div><div id="ww580490" class="CodeInTable">    is.getStream() &gt;&gt; drawChildrenBg;</div><div id="ww580491" class="CodeInTable">    _drawChildrenBg = (IlvBoolean)drawChildrenBg;</div><div id="ww580492" class="CodeInTable">}</div><div id="ww580493" class="CodeInTable">&nbsp;</div><div id="ww580494" class="CodeInTable">void</div><div id="ww580495" class="CodeInTable">ColoredTreeGadget::write(IlvOutputFile&amp; os) const</div><div id="ww580496" class="CodeInTable">{</div><div id="ww580497" class="CodeInTable">    IlvTreeGadget::write(os);</div><div id="ww580498" class="CodeInTable">    // Write the _drawChildrenBg flag.</div><div id="ww580499" class="CodeInTable">    os.getStream() &lt;&lt; IlvSpc() &lt;&lt; (int)_drawChildrenBg &lt;&lt; IlvSpc();</div><div id="ww580480" class="CodeInTable">}</div></td></tr></table></div><div id="ww578971" class="Heading3"><span></span>Adding Accessors</div><div id="ww575400" class="Body">Adding accessors to objects makes them available for scripting. The following description shows an example of an accessor to the <span class="code">_drawChildrenBg</span> member variable.</div><div id="ww578974" class="Body">First, the symbol that will be used to access this variable is defined. This is done through the static function <span class="code">GetDrawChildrenBackgroundSymbol</span>.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580515" class="CodeInTable">static IlvSymbol*</div><div id="ww580516" class="CodeInTable">GetDrawChildrenBackgroundSymbol()</div><div id="ww580517" class="CodeInTable">{</div><div id="ww580518" class="CodeInTable">    // This symbol is used to access to drawChildrenBackground accessor of</div><div id="ww580519" class="CodeInTable">    // the colored tree gadget.</div><div id="ww580520" class="CodeInTable">    static IlvSymbol* symbol = IlvGetSymbol("drawChildrenBackground");</div><div id="ww580521" class="CodeInTable">    return symbol;</div><div id="ww580511" class="CodeInTable">}</div></td></tr></table></div><div id="ww575425" class="Body">Then, the new accessor is registered in <span class="code">GetAccessors</span>:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580537" class="CodeInTable">void</div><div id="ww580538" class="CodeInTable">ColoredTreeGadget::GetAccessors(const IlvSymbol* const** a,</div><div id="ww580539" class="CodeInTable">                                const IlvValueTypeClass* const** t,</div><div id="ww580540" class="CodeInTable">                                IlvUInt&amp; c)</div><div id="ww580541" class="CodeInTable">{</div><div id="ww580542" class="CodeInTable">    DeclareAccessor(GetDrawChildrenBackgroundSymbol(),</div><div id="ww580543" class="CodeInTable">                    IlvValueBooleanType,</div><div id="ww580544" class="CodeInTable">                    a,</div><div id="ww580545" class="CodeInTable">                    t,</div><div id="ww580546" class="CodeInTable">                    c);</div><div id="ww580533" class="CodeInTable">}</div></td></tr></table></div><div id="ww575455" class="Body">The <span class="code">queryValue</span> method is called when the value of the accessor is queried.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580558" class="CodeInTable">IlvValue&amp;</div><div id="ww580559" class="CodeInTable">ColoredTreeGadget::queryValue(IlvValue&amp; value) const</div><div id="ww580560" class="CodeInTable">{</div><div id="ww580561" class="CodeInTable">    if (value.getName() == GetDrawChildrenBackgroundSymbol())</div><div id="ww580562" class="CodeInTable">        return value = isDrawingChildrenBackground();</div><div id="ww580563" class="CodeInTable">    else</div><div id="ww580564" class="CodeInTable">        return IlvTreeGadget::queryValue(value);</div><div id="ww580565" class="CodeInTable">}</div></td></tr></table></div><div id="ww575468" class="Body">The <span class="code">applyValue</span> method is called when the value of the accessor is modified.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580580" class="CodeInTable">IlvBoolean</div><div id="ww580581" class="CodeInTable">ColoredTreeGadget::applyValue(const IlvValue&amp; value)</div><div id="ww580582" class="CodeInTable">{</div><div id="ww580583" class="CodeInTable">    if (value.getName() == GetDrawChildrenBackgroundSymbol()) {</div><div id="ww580584" class="CodeInTable">        drawChildrenBackground((IlvBoolean)value, IlvFalse);</div><div id="ww580585" class="CodeInTable">        return IlvTrue;</div><div id="ww580586" class="CodeInTable">    } else</div><div id="ww580587" class="CodeInTable">        return IlvTreeGadget::applyValue(value);</div><div id="ww580588" class="CodeInTable">}</div></td></tr></table></div><div id="ww574998" class="Subhead"><span></span>Modifying How the New Gadget is Drawn</div><div id="ww575004" class="Body">The next step is to change the way <span class="code">ColoredTreeGadget</span> is drawn. The standard way to change the drawing of a graphical object is to override its <span class="code">draw</span> method defined at the <span class="code">IlvGraphic</span> level: </div><div id="ww575293" class="NormalCode">virtual void draw(IlvPort*              dst,</div><div id="ww575295" class="NormalCode">                  const IlvTransformer* t = 0,</div><div id="ww575296" class="LastNormalCode">                  const IlvRegion*      clip = 0) const = 0;</div><div id="ww575298" class="Body">However, the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvTreeGadget.html">IlvTreeGadget</a></span> is a complex object and has several other methods that can help customize its drawing. Here, you want to draw the background before each item is drawn. You can use the <span class="ClassName"><a href="../RefMan/refcppgadgets/classIlvGadgetItemHolder.html">IlvGadgetItemHolder</a></span><span class="code">::drawGadgetItem</span> method. It is called by the tree to draw each item.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580599" class="CodeInTable">void</div><div id="ww580600" class="CodeInTable">ColoredTreeGadget::drawGadgetItem(const IlvGadgetItem* item,</div><div id="ww580601" class="CodeInTable">                                  IlvPort* port,</div><div id="ww580602" class="CodeInTable">                                  const IlvRect&amp; rect,</div><div id="ww580603" class="CodeInTable">                                  const IlvTransformer* t,</div><div id="ww580604" class="CodeInTable">                                  const IlvRegion* clip) const</div><div id="ww580605" class="CodeInTable">{</div><div id="ww580606" class="CodeInTable">    if (isDrawingChildrenBackground()) {</div><div id="ww580607" class="CodeInTable">         // Check if the item being drawn has a special palette.</div><div id="ww580608" class="CodeInTable">         IlvPalette* palette = getBackgroundPalette((IlvTreeGadgetItem*)item);</div><div id="ww580609" class="CodeInTable">         if (palette) {</div><div id="ww580610" class="CodeInTable">             // Compute the visible bounding box.</div><div id="ww580611" class="CodeInTable">             IlvRect bbox;</div><div id="ww580612" class="CodeInTable">             visibleBBox(bbox, t);</div><div id="ww580613" class="CodeInTable">             // Move and resize it to match the item bounding box.</div><div id="ww580614" class="CodeInTable">             bbox.y(rect.y());</div><div id="ww580615" class="CodeInTable">             bbox.h(rect.h());</div><div id="ww580616" class="CodeInTable">             if (clip)</div><div id="ww580617" class="CodeInTable">                 palette-&gt;setClip(clip);</div><div id="ww580618" class="CodeInTable">             port-&gt;fillRectangle(palette, bbox);</div><div id="ww580619" class="CodeInTable">             if (clip)</div><div id="ww580620" class="CodeInTable">                 palette-&gt;setClip();</div><div id="ww580621" class="CodeInTable">        }</div><div id="ww580622" class="CodeInTable">    }</div><div id="ww580623" class="CodeInTable">    // Draw the item.</div><div id="ww580624" class="CodeInTable">    IlvTreeGadget::drawGadgetItem(item, port, rect, t, clip);</div><div id="ww580595" class="CodeInTable">}</div></td></tr></table></div><div id="ww575354" class="Body">The <span class="code">getBackgroundPalette</span> method is used to retrieve the palette used to draw the background of a tree item.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580640" class="CodeInTable">IlvPalette*</div><div id="ww580641" class="CodeInTable">ColoredTreeGadget::getBackgroundPalette(const IlvTreeGadgetItem* item) const</div><div id="ww580642" class="CodeInTable">{</div><div id="ww580643" class="CodeInTable">    // Returns the palette that will be used to draw the background of ’item’</div><div id="ww580644" class="CodeInTable">    // This information is stored in its parent</div><div id="ww580645" class="CodeInTable">    if (item-&gt;getParent()) {</div><div id="ww580646" class="CodeInTable">        IlvPalette* palette = (IlvPalette*)</div><div id="ww580647" class="CodeInTable">            item-&gt;getParent()-&gt;getProperty(GetChildrenBackgroundSymbol());</div><div id="ww580648" class="CodeInTable">        if (!palette)</div><div id="ww580649" class="CodeInTable">            palette = getBackgroundPalette(item-&gt;getParent());</div><div id="ww580650" class="CodeInTable">        return palette;</div><div id="ww580651" class="CodeInTable">    } else</div><div id="ww580652" class="CodeInTable">        return 0;</div><div id="ww580636" class="CodeInTable">}</div></td></tr></table></div><div id="ww575372" class="Body">The <span class="code">getBackgroundPalette</span> method tries to find the first parent of ‘item’ that has been set as a background palette. This means that a tree item inherits its color from its parent—changing the background color of an item may not only change the background color of its children, but also the background color of the children of its children, and so on.</div><div id="ww575000" class="Subhead"><span></span>Testing the New Gadget Class</div><div id="ww575005" class="Body">The file <span class="code">main.cpp</span> contains the code to test the <span class="code">ColoredTreeGadget</span> class. It reads the file <span class="code">coltree.ilv</span>, which contains the description of a <span class="code">ColoredTreeGadget</span> instance, and changes the color of all items according to their level.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580673" class="CodeInTable">    // Read the file that contains the colored tree.</div><div id="ww580674" class="CodeInTable">    container-&gt;readFile("../doc/gadgets/tutorials/custgad/data/coltree.ilv");</div><div id="ww580675" class="CodeInTable">&nbsp;</div><div id="ww580676" class="CodeInTable">    // Retrieve the tree.</div><div id="ww580677" class="CodeInTable">    ColoredTreeGadget* tree = (ColoredTreeGadget*)container-&gt;getObject("Tree");</div><div id="ww580678" class="CodeInTable">&nbsp;</div><div id="ww580679" class="CodeInTable">    // Set the background of the tree to gray.</div><div id="ww580680" class="CodeInTable">    // This color will be used as the reference color to compute the children</div><div id="ww580681" class="CodeInTable">    // colors.</div><div id="ww580682" class="CodeInTable">    tree-&gt;setBackground(display-&gt;getColor("gray"));</div><div id="ww580683" class="CodeInTable">&nbsp;</div><div id="ww580684" class="CodeInTable">    // Now change the color of each level of items.</div><div id="ww580685" class="CodeInTable">    tree-&gt;applyToItems(ChangeColor, (IlvAny)tree);</div></td></tr></table></div><div id="ww575498" class="Body">The <span class="code">applyToItems</span> method applies the <span class="code">ChangeColor</span> function to every item in the tree. Here is the description of this <span class="code">ChangeColor</span> function, which calls the <span class="code">ColoredTreeGadget::setChildrenBackground</span> method:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580700" class="CodeInTable">static IlvBoolean</div><div id="ww580701" class="CodeInTable">ChangeColor(IlvGadgetItem* item, IlvAny arg)</div><div id="ww580702" class="CodeInTable">{</div><div id="ww580703" class="CodeInTable">    // The argument is a pointer to the ColoredTreeGadget instance.</div><div id="ww580704" class="CodeInTable">    ColoredTreeGadget* tree = (ColoredTreeGadget*)arg;</div><div id="ww580705" class="CodeInTable">    // Change the background of the children of ‘item’.</div><div id="ww580706" class="CodeInTable">    tree-&gt;setChildrenBackground((IlvTreeGadgetItem*)item,</div><div id="ww580707" class="CodeInTable">                                GetChildrenColor((IlvTreeGadgetItem*)item,</div><div id="ww580708" class="CodeInTable">                                                    tree-&gt;getBackground()),</div><div id="ww580709" class="CodeInTable">                                                    IlvFalse);</div><div id="ww580710" class="CodeInTable">    // Continue.</div><div id="ww580711" class="CodeInTable">    return IlvTrue;</div><div id="ww580696" class="CodeInTable">}</div></td></tr></table></div><div id="ww575514" class="Body">Another static function is used to compute the color using a tree item and a reference color:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww580731" class="CodeInTable">static IlvColor*</div><div id="ww580732" class="CodeInTable">GetChildrenColor(IlvTreeGadgetItem* item, IlvColor* color)</div><div id="ww580733" class="CodeInTable">{</div><div id="ww580734" class="CodeInTable">    // Get the item level to choose the right color.</div><div id="ww580735" class="CodeInTable">    IlvUInt level = item-&gt;getLevel();</div><div id="ww580736" class="CodeInTable">    // Compute the HSV components of the reference color.</div><div id="ww580737" class="CodeInTable">    IlvFloat h, s, v;</div><div id="ww580738" class="CodeInTable">    color-&gt;getHSV(h, s, v);</div><div id="ww580739" class="CodeInTable">    // Increase the V component.</div><div id="ww580740" class="CodeInTable">    v = (IlvFloat)IlvMin((IlvFloat)1., (IlvFloat)(v + level*.08));</div><div id="ww580741" class="CodeInTable">    // Return the new color.</div><div id="ww580742" class="CodeInTable">    return color-&gt;getDisplay()-&gt;getColor(h, s, v);</div><div id="ww580723" class="CodeInTable">}</div></td></tr></table></div><div id="ww575533" class="Body">This function uses the level of the item and the specified reference color to compute a new color. This new color is computed by changing the V component of the reference color in the HSV model.</div><div id="ww575976" class="Body">This is the end of Step 1. The test program should look like this:</div><div class="ww_skin_page_overflow"><div id="ww575981" class="Startplain"><img class="Default" src="../Tutorials/images/coltree.png" width="100%" style="display: block; left: 0.0pt; max-height: 291px; max-width: 371px; top: 0.0pt" alt="" /></div></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>