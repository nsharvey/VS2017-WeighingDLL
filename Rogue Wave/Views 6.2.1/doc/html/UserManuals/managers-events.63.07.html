<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Example of an Extension: IlvMoveInteractor</title><link rel="Prev" href="managers-events.63.06.html" title="Previous" /><link rel="Next" href="managers-events.63.08.html" title="Next" /><link rel="StyleSheet" href="css/managers-events.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/managers-events_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/UserManuals/managers-events.63.07.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pKU_002bGZcBO9ALmtkzp96G2QA" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/UserManuals/managers-events.63.07.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../UserManuals/twodgfrontcover.html#wwconnect_header">2D Graphics</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../UserManuals/twodgpart1.html#ww144909">Managers</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../UserManuals/managers-events.63.01.html#wwconnect_header">Manager Event Handling</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../UserManuals/managers-events.63.04.html#wwconnect_header">View Interactors</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Example of an Extension: IlvMoveInteractor</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww658002" class="Heading2"><span></span>Example of an Extension: IlvMoveInteractor</div><div id="ww658004" class="Body">This is a complete example of a direct subtype of the <span class="ClassName"><a href="../RefMan/refcppmanager/classIlvManagerViewInteractor.html">IlvManagerViewInteractor</a></span> class. It allows the user to move a graphic object to another location by dragging it with the mouse. Here is the declaration of this class (it can also be found in the header file <span class="code">&lt;ilviews/manager/movinter.h&gt;</span>):</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658007" class="CodeInTable">class IlvMoveInteractor </div><div id="ww658008" class="CodeInTable">: public IlvManagerViewInteractor</div><div id="ww658009" class="CodeInTable">{</div><div id="ww658010" class="CodeInTable">public:</div><div id="ww658011" class="CodeInTable">    IlvMoveInteractor(IlvManager* manager,</div><div id="ww658012" class="CodeInTable">                      IlvView*    view)</div><div id="ww658013" class="CodeInTable">        : IlvManagerViewInteractor(manager, view),</div><div id="ww658014" class="CodeInTable">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_move(0) {}</div><div id="ww658015" class="CodeInTable">&nbsp;</div><div id="ww658016" class="CodeInTable">&nbsp;&nbsp;&nbsp;&nbsp;virtual IlBoolean handleEvent(IlvEvent&amp; event);</div><div id="ww658017" class="CodeInTable">    virtual void   handleExpose(IlvRegion* clip = 0);</div><div id="ww658018" class="CodeInTable">    virtual void   drawGhost();</div><div id="ww658019" class="CodeInTable">    void           drawGhost(const IlvRect&amp;,</div><div id="ww658020" class="CodeInTable">                             IlvRegion* clip = 0);</div><div id="ww658021" class="CodeInTable">    void           drawGhost(IlvGraphic*, IlvRegion* clip = 0);</div><div id="ww658022" class="CodeInTable">    virtual void   doIt(const IlvPoint&amp;);</div><div id="ww658023" class="CodeInTable">    const IlvRect&amp; getRectangle() const {return _xor_rectangle;}</div><div id="ww658024" class="CodeInTable">protected:</div><div id="ww658025" class="CodeInTable">    IlvPos         _deltax, _deltay;</div><div id="ww658026" class="CodeInTable">    IlvRect        _bbox;</div><div id="ww658027" class="CodeInTable">    IlvGraphic*    _move;</div><div id="ww658028" class="CodeInTable">    IlvRect        _xor_rectangle;</div><div id="ww658029" class="CodeInTable">    IlBoolean     _wasSelected;</div><div id="ww658030" class="CodeInTable">    void           handleButtonDown(const IlvPoint&amp;);</div><div id="ww666425" class="CodeInTable">    void           handleButtonDragged(const IlvPoint&amp;);</div><div id="ww666426" class="CodeInTable">    void           handleButtonUp(const IlvPoint&amp;);</div><div id="ww666420" class="CodeInTable">};</div></td></tr></table></div><div id="ww658033" class="Body">This interactor lets you select and deselect objects by clicking on them with the left mouse button and the Shift key pressed. You can move an object or a set of selected objects but you cannot resize them.</div><div id="ww658034" class="Body">The following protected fields are used in this class:</div><div id="ww658035" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">_deltax, _deltay</span> - Stores the distance between the mouse and the top-left corner of the objects being moved.</div><div id="ww658036" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">_bbox</span> - Stores the bounding box of the objects being moved.</div><div id="ww658037" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">_move</span> - Keeps a pointer to the object being moved.</div><div id="ww658038" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">_xor_rectangle</span> - Stores the rectangle dragged to mark a region.</div><div id="ww658039" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><span class="code">_wasSelected</span> - Keeps a Boolean value indicating whether the designated object was selected before it was moved. This information is required because the object is selected when you start to move it. There are two different cases in this interactor, depending on whether one or more object is being moved. If more than one object is moved, a moving rectangle that encloses the bounding boxes of these objects is displayed. Otherwise, the moving objects themselves are displayed.</div><div id="ww663641" class="Body">The following member function are described in this section:</div><div id="ww658044" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658075" title="Example of an Extension: IlvMoveInteractor">handleEvent Member Function</a></div><div id="ww658048" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658179" title="Example of an Extension: IlvMoveInteractor">drawGhost Member Function</a></div><div id="ww658052" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658195" title="Example of an Extension: IlvMoveInteractor">drawGhost for a Rectangle</a></div><div id="ww658056" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658222" title="Example of an Extension: IlvMoveInteractor">drawGhost for an Object</a></div><div id="ww658060" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658248" title="Example of an Extension: IlvMoveInteractor">doIt Member Function</a></div><div id="ww658064" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658287" title="Example of an Extension: IlvMoveInteractor">handleButtonDown Member Function</a></div><div id="ww658068" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658322" title="Example of an Extension: IlvMoveInteractor">handleButtonDragged Member Function</a></div><div id="ww658072" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658344" title="Example of an Extension: IlvMoveInteractor">handleButtonUp Member Function</a></div><div id="ww658075" class="Heading3"><span></span>handleEvent Member Function</div><div id="ww663873" class="Body">The following code focuses on mouse events. All other events are dispatched to accelerators by a call to <span class="ClassName"><a href="../RefMan/refcppmanager/classIlvManager.html">IlvManager</a></span><span class="code">::shortCut</span>, but only if an object is not being moved at this point. This is because some accelerators might remove the object being worked on, which can be dangerous. The <span class="code">handleEvent()</span> function returns <span class="code">IlTrue</span> if it has consumed the event and <span class="code">IlFalse</span> otherwise.</div><div id="ww670434" class="NormalCode">IlBoolean</div><div id="ww670435" class="NormalCode">IlvMoveInteractor::handleEvent(IlvEvent&amp; event)</div><div id="ww670436" class="NormalCode">{</div><div id="ww670437" class="NormalCode">    IlBoolean consumed = IlFalse;</div><div id="ww670438" class="NormalCode">    switch (event.type()) {</div><div id="ww670439" class="NormalCode">    case IlvButtonDown:</div><div id="ww670440" class="NormalCode">        _xor_rectangle.w(0);</div><div id="ww670441" class="NormalCode">        _move = 0;</div><div id="ww670442" class="NormalCode">        if (event.modifiers() &amp; (IlvLockModifier | IlvNumModifier)) {</div><div id="ww670443" class="NormalCode">            consumed = IlTrue;</div><div id="ww670444" class="NormalCode">            getManager()-&gt;getDisplay()-&gt;bell();</div><div id="ww670445" class="NormalCode">            return consumed;</div><div id="ww670446" class="NormalCode">        }</div><div id="ww670447" class="NormalCode">        if (event.button() != IlvLeftButton) {</div><div id="ww670448" class="NormalCode">            consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww670449" class="NormalCode">            return consumed;</div><div id="ww670450" class="NormalCode">        }</div><div id="ww670451" class="NormalCode">        if (!event.modifiers()) {</div><div id="ww670452" class="NormalCode">            consumed = IlTrue;</div><div id="ww670453" class="NormalCode">            handleButtonDown(IlvPoint(event.x(), event.y()));</div><div id="ww670454" class="NormalCode">        } else {</div><div id="ww670455" class="NormalCode">            IlvManager* manager = getManager();</div><div id="ww670456" class="NormalCode">            if (event.modifiers() &amp; IlvShiftModifier) {</div><div id="ww670457" class="NormalCode">                consumed = IlTrue;</div><div id="ww670458" class="NormalCode">                IlvPoint p(event.x(), event.y());</div><div id="ww670459" class="NormalCode">                IlvGraphic* obj = manager-&gt;lastContains (p,getView());</div><div id="ww670460" class="NormalCode">                IlvDrawSelection* sel = 0;</div><div id="ww670461" class="NormalCode">                if (obj) sel = getSelection(obj);</div><div id="ww670462" class="NormalCode">                if (!sel &amp;&amp; obj &amp;&amp; manager()-&gt;isSelectable(obj)) {</div><div id="ww670463" class="NormalCode">                    manager-&gt;setSelected(!manager-&gt;isSelected(obj));</div><div id="ww670464" class="NormalCode">                }</div><div id="ww670465" class="NormalCode">            } else</div><div id="ww670466" class="NormalCode">                consumed = manager-&gt;shortCut(event, getView());</div><div id="ww670467" class="NormalCode">        }</div><div id="ww670468" class="NormalCode">        break;</div><div id="ww670469" class="NormalCode">    case IlvButtonUp:</div><div id="ww670470" class="NormalCode">        if (event.button() == IlvLeftButton) {</div><div id="ww670471" class="NormalCode">            consumed = IlTrue;</div><div id="ww670472" class="NormalCode">            handleButtonUp(IlvPoint(event.x(), event.y()));</div><div id="ww670473" class="NormalCode">        } else { </div><div id="ww670474" class="NormalCode">            consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww670475" class="NormalCode">        }</div><div id="ww670476" class="NormalCode">        break;</div><div id="ww670477" class="NormalCode">    case IlvButtonDragged:</div><div id="ww670478" class="NormalCode">        if (event.modifiers() == IlvLeftButton){</div><div id="ww670479" class="NormalCode">            consumed = IlTrue;</div><div id="ww670480" class="NormalCode">            IlvPoint p(event.x(), event.y());</div><div id="ww670481" class="NormalCode">            handleButtonDragged(p);</div><div id="ww670482" class="NormalCode">        }</div><div id="ww670483" class="NormalCode">        break;</div><div id="ww670484" class="NormalCode">    default:</div><div id="ww670485" class="NormalCode">        if (!_move)</div><div id="ww670486" class="NormalCode">            consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww670487" class="NormalCode">        break;</div><div id="ww670488" class="NormalCode">    }</div><div id="ww670489" class="NormalCode">    return consumed;</div><div id="ww658121" class="LastNormalCode">}</div><div id="ww663680" class="Body">The following types of events are handled by the <span class="code">handleEvent</span> member function:</div><div id="ww663688" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww663886" title="Example of an Extension: IlvMoveInteractor">Button-Down Events</a></div><div id="ww663692" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658155" title="Example of an Extension: IlvMoveInteractor">Button-Up Events</a></div><div id="ww663696" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../UserManuals/managers-events.63.07.html#ww658165" title="Example of an Extension: IlvMoveInteractor">Button-Dragged Events</a></div><div id="ww663886" class="Heading4">Button-Down Events</div><div id="ww663891" class="Body">The interactor is initialized by setting <span class="code">_move</span> and <span class="code">_xor_rectangle</span>:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww663889" class="CodeInTable"><span style="color: #000000; font-family: &quot;Microsoft Sans Serif&quot;; font-size: 8.0pt; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none; vertical-align: baseline">_xor_rectangle.w(0);</span></div><div id="ww663890" class="CodeInTable">_move = 0;</div></td></tr></table></div><div id="ww663898" class="Body">Only the left button is handled. If the event involves another mouse button, the event is ignored and dispatched to manager accelerators:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww670507" class="CodeInTable">if (event.button() != IlvLeftButton) {</div><div id="ww670508" class="CodeInTable">    consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww670509" class="CodeInTable">    return consumed;</div><div id="ww663897" class="CodeInTable">}</div></td></tr></table></div><div id="ww658132" class="Body">The <span class="code">handleButtonDown</span> member function is called if there is no event modifier:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww670526" class="CodeInTable">if (!event.modifiers()) {</div><div id="ww670527" class="CodeInTable">    consumed = IlTrue;</div><div id="ww670528" class="CodeInTable">    handleButtonDown(IlvPoint(event.x(), event.y()));</div><div id="ww660165" class="CodeInTable">}</div></td></tr></table></div><div id="ww658146" class="Body">If the Shift modifier is set, the selection state of the object pointed to by the mouse is toggled:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww670541" class="CodeInTable">if (event.modifiers() &amp; IlvShiftModifier) {</div><div id="ww670542" class="CodeInTable">    consumed = IlTrue;</div><div id="ww670543" class="CodeInTable">    IlvPoint p(event.x(), event.y());</div><div id="ww670544" class="CodeInTable">    IlvGraphic* obj = manager-&gt;lastContains(p, getView());</div><div id="ww670545" class="CodeInTable">    IlvDrawSelection* sel = 0;</div><div id="ww670546" class="CodeInTable">    if (obj) sel = getSelection(obj);</div><div id="ww670547" class="CodeInTable">    if (!sel &amp;&amp; obj &amp;&amp; manager()-&gt;isSelectable(obj)) {</div><div id="ww670548" class="CodeInTable">        manager-&gt;setSelected(!manager-&gt;isSelected(obj));</div><div id="ww670549" class="CodeInTable">    }</div><div id="ww658145" class="CodeInTable">}</div></td></tr></table></div><div id="ww658155" class="Heading4">Button-Up Events</div><div id="ww663927" class="Body">If the event comes from the left button, <span class="code">handleButtonUp</span> is called. Otherwise, the event is dispatched to accelerators.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww670562" class="CodeInTable">case IlvButtonUp:</div><div id="ww670563" class="CodeInTable">    if (event.button() == IlvLeftButton) {</div><div id="ww670564" class="CodeInTable">        consumed = IlTrue;</div><div id="ww670565" class="CodeInTable">        handleButtonUp(IlvPoint(event.x(), event.y()));</div><div id="ww670566" class="CodeInTable">    } else {</div><div id="ww670567" class="CodeInTable">        consumed = getManager()-&gt;shortCut(event, getView());</div><div id="ww670568" class="CodeInTable">    }</div><div id="ww658154" class="CodeInTable">    break;</div></td></tr></table></div><div id="ww658165" class="Heading4">Button-Dragged Events</div><div id="ww663940" class="Body">The <span class="code">handleButtonDragged</span> member function is called, but only if the event comes from the left button.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww670581" class="CodeInTable">case IlvButtonDragged:</div><div id="ww670582" class="CodeInTable">    if (event.modifiers() == IlvLeftButton){</div><div id="ww670583" class="CodeInTable">        consumed = IlTrue;</div><div id="ww670584" class="CodeInTable">        IlvPoint p(event.x(), event.y());</div><div id="ww670585" class="CodeInTable">        handleButtonDragged(p);</div><div id="ww670586" class="CodeInTable">    }</div><div id="ww658164" class="CodeInTable">    break;</div></td></tr></table></div><div id="ww658179" class="Heading3"><span></span>drawGhost Member Function</div><div id="ww663954" class="Body">This member function is split in three parts: the common part, which is the entry point from the member function <span class="code">handleEvent</span>, and two others, depending on the type of translation being done.</div><div id="ww663952" class="Body">If there is only one selected object, a specific <span class="code">drawGhost</span> is called for this object. Otherwise, another <span class="code">drawGhost</span> function that handles a rectangle is called:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658171" class="CodeInTable">void </div><div id="ww658172" class="CodeInTable">IlvMoveInteractor::drawGhost()</div><div id="ww658173" class="CodeInTable">{</div><div id="ww658174" class="CodeInTable">    if (!_xor_rectangle.w()) return;</div><div id="ww658175" class="CodeInTable">    if (manager()-&gt;numberOfSelections() == 1)</div><div id="ww658176" class="CodeInTable">        drawGhost(_move);</div><div id="ww658177" class="CodeInTable">    else  </div><div id="ww658178" class="CodeInTable">        drawGhost(_xor_rectangle);</div></td></tr></table></div><div id="ww658195" class="Heading3"><span></span>drawGhost for a Rectangle</div><div id="ww663960" class="Body">This member function is called if there is more than one selected object. It displays the bounding box of all the selected objects being moved in the view. The palette of the <span class="ClassName"><a href="../RefMan/refcppmanager/classIlvManager.html">IlvManager</a></span> object is used:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658184" class="CodeInTable">void </div><div id="ww658185" class="CodeInTable">IlvMoveInteractor::drawGhost(const IlvRect&amp; rect, IlvRegion* clip)</div><div id="ww658186" class="CodeInTable">{</div><div id="ww658187" class="CodeInTable">    if (!rect.w()) return;</div><div id="ww658188" class="CodeInTable">    IlvManager* manager = getManager();</div><div id="ww658189" class="CodeInTable">    if (clip) manager-&gt;getPalette()-&gt;setClip(clip);</div><div id="ww669517" class="CodeInTable">    </div><div id="ww658190" class="CodeInTable">    getView()-&gt;drawRectangle(manager-&gt;getPalette(),rect);</div><div id="ww658193" class="CodeInTable">    if (clip) manager-&gt;getPalette()-&gt;setClip();</div><div id="ww658194" class="CodeInTable">}</div></td></tr></table></div><div id="ww658222" class="Heading3"><span></span>drawGhost for an Object</div><div id="ww663971" class="Body">This member function is called if there is only one selected object. It displays the object at its new coordinates by calling the <span class="code">draw</span> member function after its palette has been set to <span class="code">XOR</span> mode. The new coordinates are computed from the difference between the coordinates of the rectangle being dragged and the coordinates of the original bounding box of the object:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658199" class="CodeInTable">void </div><div id="ww658200" class="CodeInTable">IlvMoveInteractor::drawGhost(IlvGraphic* obj, IlvRegion* clip)</div><div id="ww658201" class="CodeInTable">{</div><div id="ww658202" class="CodeInTable">    if (!getManager()-&gt;isMoveable(obj) || !_xor_rectangle.w())</div><div id="ww658203" class="CodeInTable">        return;</div><div id="ww658204" class="CodeInTable">    IlvPos tempdx, tempdy;</div><div id="ww658205" class="CodeInTable">    if (getTransformer()) {</div><div id="ww658206" class="CodeInTable">        IlvRect r1(_xor_rectangle);</div><div id="ww658207" class="CodeInTable">        IlvRect r2(_bbox);</div><div id="ww658208" class="CodeInTable">        getTransformer()-&gt;inverse(r1);</div><div id="ww658209" class="CodeInTable">        getTransformer()-&gt;inverse(r2);</div><div id="ww658210" class="CodeInTable">        tempdx = r1.x() - r2.x();</div><div id="ww658211" class="CodeInTable">        tempdy = r1.y() - r2.y();</div><div id="ww658212" class="CodeInTable">    } else {</div><div id="ww658213" class="CodeInTable">        tempdx = _xor_rectangle.x() - _bbox.x();</div><div id="ww658214" class="CodeInTable">        tempdy = _xor_rectangle.y() - _bbox.y();</div><div id="ww658215" class="CodeInTable">    }</div><div id="ww658216" class="CodeInTable">    obj-&gt;translate(tempdx, tempdy);</div><div id="ww658217" class="CodeInTable">    obj-&gt;setMode(IlvModeXor);</div><div id="ww658218" class="CodeInTable">    obj-&gt;draw(getView(), getTransformer(), clip);</div><div id="ww658219" class="CodeInTable">    obj-&gt;setMode(IlvModeSet);</div><div id="ww658220" class="CodeInTable">    obj-&gt;translate(-tempdx, -tempdy);</div><div id="ww658221" class="CodeInTable">}</div></td></tr></table></div><div id="ww658248" class="Heading3"><span></span>doIt Member Function</div><div id="ww663982" class="Body">The <span class="code">doIt</span> member function must apply the translation to all selected objects. The <span class="code">delta</span> parameter gives the translation vector expressed in the view coordinate system so it must be converted to the object coordinate system. Then the objects must be translated. This cannot be done by calling the <span class="ClassName"><a href="../RefMan/refcppfoundation/classIlvGraphic.html">IlvGraphic</a></span> member functions directly; it must be done by the manager. Here, <span class="ClassName"><a href="../RefMan/refcppmanager/classIlvManager.html">IlvManager</a></span><span class="code">::applyToSelections</span> calls <span class="code">TranslateObject</span> for each selected object:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658228" class="CodeInTable">void </div><div id="ww658229" class="CodeInTable">TranslateObject(IlvGraphic* object, IlAny argDelta)</div><div id="ww658230" class="CodeInTable">{</div><div id="ww658231" class="CodeInTable">    IlvPoint* delta = (IlvPoint*)argDelta;</div><div id="ww658232" class="CodeInTable">    object-&gt;translate(delta.x(), delta.y());</div><div id="ww658233" class="CodeInTable">}</div><div id="ww658234" class="CodeInTable">&nbsp;</div><div id="ww658235" class="CodeInTable">void </div><div id="ww658236" class="CodeInTable">IlvMoveInteractor::doIt(const IlvPoint&amp; delta)</div><div id="ww658237" class="CodeInTable">{</div><div id="ww658238" class="CodeInTable">    IlvPoint origin(0, 0),</div><div id="ww658239" class="CodeInTable">            tdelta(delta);</div><div id="ww658240" class="CodeInTable">    if (getTransformer()) {</div><div id="ww658241" class="CodeInTable">        getTransformer()-&gt;inverse(origin);</div><div id="ww658242" class="CodeInTable">        getTransformer()-&gt;inverse(tdelta);</div><div id="ww658243" class="CodeInTable">    }</div><div id="ww658244" class="CodeInTable">    IlvPoint dp(tdelta.x()-origin.x(),</div><div id="ww658245" class="CodeInTable">                tdelta.y()-origin.y());</div><div id="ww658246" class="CodeInTable">    getManager-&gt;applyToSelections(TranslateObject, &amp;dp);</div><div id="ww658247" class="CodeInTable">}</div></td></tr></table></div><div id="ww658287" class="Heading3"><span></span>handleButtonDown Member Function</div><div id="ww664317" class="Body">The <span class="code">handleButtonDown</span> member function selects the object to be moved, storing its previous state in <span class="code">_wasSelected</span>. Then, it computes the <span class="code">_bbox</span> field by means of a call to the <span class="code">ComputeBBoxSelections</span> function. This function returns in <span class="code">_bbox</span> the bounding box of all the selected objects:</div><div id="ww664323" class="NormalCode">static void </div><div id="ww664324" class="NormalCode">ComputeBBoxSelections(IlvManager* manager, IlvRect&amp; bbox, IlvView* view)</div><div id="ww664325" class="NormalCode">{</div><div id="ww664326" class="NormalCode">    bbox.resize(0, 0);</div><div id="ww664327" class="NormalCode">    IlUInt nbselections;</div><div id="ww664328" class="NormalCode">    IlvGraphic** objs = manager-&gt;getSelections(nbselections);</div><div id="ww664329" class="NormalCode">    IlvRect rect;</div><div id="ww664330" class="NormalCode">    IlvTransformer* t = manager-&gt;getTransformer(view);</div><div id="ww664331" class="NormalCode">    for (IlUInt i=0; i &lt; nbselections; i++) {</div><div id="ww664332" class="NormalCode">        objs[i]-&gt;boundingBox(rect, t);</div><div id="ww664333" class="NormalCode">        bbox.add(rect);</div><div id="ww664334" class="NormalCode">    }</div><div id="ww664335" class="NormalCode">}</div><div id="ww664336" class="NormalCode">void </div><div id="ww664337" class="NormalCode">IlvMoveInteractor::handleButtonDown(const IlvPoint&amp; p)</div><div id="ww664338" class="NormalCode">{</div><div id="ww664339" class="NormalCode">    IlvGraphic* obj = getManager()-&gt;lastContains(p, getView());</div><div id="ww664340" class="NormalCode">    if (!obj) return;</div><div id="ww664341" class="NormalCode">    IlvDrawSelection* sel = manager()-&gt;getSelection(obj);</div><div id="ww664342" class="NormalCode">    if (!sel &amp;&amp; getManager()-&gt;isSelectable(obj)) {</div><div id="ww664343" class="NormalCode">        getManager()-&gt;deSelect();</div><div id="ww664344" class="NormalCode">        getManager()-&gt;makeSelected(obj);</div><div id="ww664345" class="NormalCode">        _wasSelected = IlFalse;</div><div id="ww664346" class="NormalCode">        sel = getManager()-&gt;getSelection(obj);</div><div id="ww664347" class="NormalCode">    } else </div><div id="ww664348" class="NormalCode">        _wasSelected = IlTrue;</div><div id="ww664349" class="NormalCode">    if (sel) {</div><div id="ww664350" class="NormalCode">        ComputeBBoxSelections(getManager(), _bbox, getView());</div><div id="ww664351" class="NormalCode">        _move   = obj;</div><div id="ww664352" class="NormalCode">        _deltax = _bbox.x() - p.x();</div><div id="ww664353" class="NormalCode">        _deltay = _bbox.y() - p.y();</div><div id="ww664354" class="NormalCode">    }</div><div id="ww664318" class="LastNormalCode">}</div><div id="ww658289" class="Body">The <span class="code">ComputeBBoxSelections</span> section is described in more detail.</div><div id="ww664004" class="Body">The first part initializes the result to the empty rectangle, and then queries the manager for all the selected objects. <span class="code">nbselections</span> is the number of selected objects in the array <span class="code">objs</span>:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww660109" class="CodeInTable">bbox.resize(0, 0);</div><div id="ww660111" class="CodeInTable">IlUInt nbselections;</div><div id="ww660112" class="CodeInTable">IlvGraphic** objs = manager-&gt;getSelections(nbselections);</div></td></tr></table></div><div id="ww658293" class="Body">The next part starts a loop to scan every object:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww660120" class="CodeInTable">IlvRect rect;</div><div id="ww660122" class="CodeInTable">for (IlUInt i=0; i &lt; nbselections; i++) {</div></td></tr></table></div><div id="ww658296" class="Body">This next part reads the bounding box of each object, transformed in the view coordinate system, and adds it to the result:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww660132" class="CodeInTable">objs[i]-&gt;boundingBox(rect, t);</div><div id="ww660134" class="CodeInTable">for (IlUInt i=0; i &lt; nbselections; i++) {</div><div id="ww660135" class="CodeInTable">    objs[i]-&gt;boundingBox(rect, t);</div><div id="ww660136" class="CodeInTable">    bbox.add(rect);</div><div id="ww660137" class="CodeInTable">}</div></td></tr></table></div><div id="ww658322" class="Heading3"><span></span>handleButtonDragged Member Function</div><div id="ww664031" class="Body">If there is a moving object and if it is moveable, the dragging position is snapped to the manager grid (if one exists) and a new <span class="code">_xor_rectangle</span> is computed. Then, the member function <span class="code">ensureVisible</span> makes sure that the point the user drags will remain on the visible part of the view:</div><div id="ww664364" class="NormalCode">void </div><div id="ww664365" class="NormalCode">IlvMoveInteractor::handleButtonDragged(const IlvPoint&amp; point)</div><div id="ww664366" class="NormalCode">{</div><div id="ww664367" class="NormalCode">    if (!_move) return;</div><div id="ww664368" class="NormalCode">    IlvPoint p = point;</div><div id="ww664369" class="NormalCode">    IlvRect  rect;</div><div id="ww664370" class="NormalCode">    if (getManager()-&gt;isMoveable(_move)) {</div><div id="ww664371" class="NormalCode">        if (_xor_rectangle.w()) drawGhost();</div><div id="ww664372" class="NormalCode">        p.translate(_deltax, _deltay);</div><div id="ww664373" class="NormalCode">        getManager()-&gt;snapToGrid(getView(), p);</div><div id="ww664374" class="NormalCode">        p.translate(-_deltax, -_deltay);</div><div id="ww664375" class="NormalCode">        _xor_rectangle.move(p.x() + _deltax, p.y() + _deltay);</div><div id="ww664376" class="NormalCode">        _xor_rectangle.resize(_bbox.w(), _bbox.h());</div><div id="ww664377" class="NormalCode">        ensureVisible(p);</div><div id="ww664378" class="NormalCode">        drawGhost();</div><div id="ww664379" class="NormalCode">    }</div><div id="ww664360" class="LastNormalCode">}</div><div id="ww658344" class="Heading3"><span></span>handleButtonUp Member Function</div><div id="ww664042" class="Body">If there are objects to move, they are translated by calling the member function <span class="code">doIt</span>. Otherwise, the last designated object is deselected:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; border-bottom-color: none; border-bottom-style: none; border-bottom-width: 0.0pt; border-left-color: none; border-left-style: none; border-left-width: 0.0pt; border-right-color: none; border-right-style: none; border-right-width: 0.0pt; border-top-color: none; border-top-style: none; border-top-width: 0.0pt; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww658326" class="CodeInTable">void </div><div id="ww658327" class="CodeInTable">IlvMoveInteractor::handleButtonUp(const IlvPoint&amp;)</div><div id="ww658328" class="CodeInTable">{</div><div id="ww658329" class="CodeInTable">    if (!_move) return;</div><div id="ww658330" class="CodeInTable">    IlvDrawSelection* sel = getManager()-&gt;getSelection(_move);</div><div id="ww658331" class="CodeInTable">    if (_move &amp;&amp; _xor_rectangle.w() &amp;&amp; sel) {</div><div id="ww658332" class="CodeInTable">        drawGhost();</div><div id="ww658333" class="CodeInTable">        IlvDeltaPoint delta(_xor_rectangle.x() - _bbox.x(),</div><div id="ww658334" class="CodeInTable">                            _xor_rectangle.y() - _bbox.y());</div><div id="ww658335" class="CodeInTable">        _xor_rectangle.w(0);</div><div id="ww658336" class="CodeInTable">        _move = 0;</div><div id="ww658337" class="CodeInTable">        doIt(delta);</div><div id="ww658338" class="CodeInTable">    } else {</div><div id="ww658339" class="CodeInTable">        _xor_rectangle.w(0);</div><div id="ww658340" class="CodeInTable">        _move = 0;</div><div id="ww658341" class="CodeInTable">        if (sel &amp;&amp; _wasSelected) getManager()-&gt;deSelect();</div><div id="ww658342" class="CodeInTable">    }</div><div id="ww658343" class="CodeInTable">}</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright Â© 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>