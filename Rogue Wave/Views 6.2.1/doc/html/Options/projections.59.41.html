<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Writing the Forward Projection</title><link rel="Prev" href="projections.59.40.html" title="Previous" /><link rel="Next" href="projections.59.42.html" title="Next" /><link rel="StyleSheet" href="css/projections.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/projections_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Options/projections.59.41.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pS87CKA8ubdhSe_002bUZjtDDxQ" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Options/projections.59.41.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Options/docfrontcover.html#wwconnect_header">Maps</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/projections.59.01.html#wwconnect_header">Map Projections</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/projections.59.38.html#wwconnect_header">Creating a New Projection</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Writing the Forward Projection</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww1012193" class="Heading2"><span></span>Writing the Forward Projection</div><div id="ww1012195" class="Body">Before writing the forward functions for the Mercator projection, you must be familiar with the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvProjection.html">IlvProjection</a></span><span class="code">::forward</span> function.</div><div id="ww1012196" class="Heading3"><span></span>The IlvProjection::forward Function </div><div id="ww1012198" class="Body">The <span class="code">IlvProjection::forward</span> public function is called by the user to project data. The function prepares data for projection computation and scales it appropriately. It then redirects the calls to either one of the <span class="code">eForward</span> or <span class="code">sForward</span> protected functions which are defined in the projection subclass (the Mercator class in our example).</div><div id="ww1012199" class="Body">The <span class="code">IlvProjection::forward</span> function:</div><div id="ww1012200" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>adjusts the latitude if the coordinates are geocentric, </div><div id="ww1012201" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>adjusts the longitude to the central meridian of the projection, </div><div id="ww1012202" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>adjusts the longitude to the range <span class="code">[-PI;PI]</span>, if longitude reduction is used (the default value), </div><div id="ww1012203" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>calls either the function <span class="code">sForward</span> or <span class="code">eForward</span> depending on whether the earth is represented as a sphere or as an ellipsoid, and </div><div id="ww1012204" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>adjusts the projected data to the dimensions of the ellipsoid as well as to the Cartesian offsets, and converts them to the selected measurement unit. </div><div id="ww1012205" class="Heading3"><span></span>Projecting Data from a Sphere </div><div id="ww1012206" class="Body">The <span class="code">sForward</span> protected function implements the projection for a sphere. </div><div id="ww1012207" class="Body">Since the appropriate scaling is actually carried out by the function <span class="code">IlvProjection::forward</span>, the <span class="code">sForward</span> function always assumes that the radius of the sphere is 1. </div><div id="ww1012208" class="Body">In our example, the Mercator function is the projection of a sphere on a cylinder that is tangent to the equator. The <span class="code">x</span> coordinate is equal to the longitude (expressed in radians) because we assume that the radius of the sphere is 1. In this case, we do not have to change the <span class="code">x</span> value of <span class="code">ll</span>. </div><div id="ww1012209" class="Body">Because the Mercator projection cannot show regions near the poles, an error code is returned if the latitude is too close to <span class="code">PI/2</span>.</div><div id="ww1012210" class="Body">We apply the following equation to compute the <span class="code">y</span> coordinate of the projected data. </div><div id="ww1012211" class="NormalCode">IlvMapsError</div><div id="ww1013207" class="NormalCode">Mercator::sForward(IlvCoordinate&amp; ll) const</div><div id="ww1013208" class="NormalCode">{</div><div id="ww1013209" class="NormalCode">    // Return an error if the point is close to a pole.</div><div id="ww1013210" class="NormalCode">    if (fabs(fabs(ll.y()) - IlvMaps::Pi() / 2.) &lt;= 1e-10)</div><div id="ww1013211" class="NormalCode">     return ToleranceConditionError();</div><div id="ww1013212" class="NormalCode">    </div><div id="ww1013213" class="NormalCode">    ll.setY(log(tan(IlvMaps::Pi() / 4. + 0.5 * ll.y())));</div><div id="ww1013214" class="LastNormalCode">    return IlvMaps::NoError();</div><div id="ww1012212" class="Heading3"><span></span>Projecting Data from an Ellipsoid </div><div id="ww1012213" class="Body">The <span class="code">eForward</span> protected function is called by the <span class="code">IlvProjection::forward</span> function if data is projected from a nonspherical ellipsoid.</div><div id="ww1012214" class="Body">It is not necessary for you to implement the <span class="code">eForward</span> function for your projection. If you are projecting data from a nonspherical ellipsoid and if the projection you are using does not support this kind of ellipsoid, the <span class="code">forward</span> function will return the error code given by <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvProjection.html">IlvProjection</a></span><span class="code">::UnsupportedFeatureError</span>(). In this case, you can use any spherical ellipsoid or create an equivalent sphere using the appropriate conversion functions of the class <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvEllipsoid.html">IlvEllipsoid</a></span>. </div><div id="ww1012216" class="Body">The <span class="code">eForward</span> function is slightly more complex than the <span class="code">sForward</span> function although the formulas obtain equivalent results if <span class="code">getEllipsoid()-&gt;getE()</span> returns <span class="code">0</span>. </div><div id="ww1012217" class="NormalCode">IlvMapsError</div><div id="ww1013218" class="NormalCode">Mercator::eForward(IlvCoordinate&amp; ll) const</div><div id="ww1013219" class="NormalCode">{</div><div id="ww1013220" class="NormalCode">    // Return an error if the point is close to a pole.</div><div id="ww1013221" class="NormalCode">    if (fabs(fabs(ll.y()) - IlvMaps::Pi() / 2.) &lt;= 1e-10)</div><div id="ww1013222" class="NormalCode">     return ToleranceConditionError();</div><div id="ww1013223" class="NormalCode">&nbsp;</div><div id="ww1013224" class="NormalCode">    IlvDoublee = sqrt(getEllipsoid()-&gt;getES());</div><div id="ww1013225" class="NormalCode">    IlvDouble   sinphi = e * sin(ll.y());</div><div id="ww1013226" class="NormalCode">    </div><div id="ww1013227" class="NormalCode">    ll.setY(tan(.5 * (IlvMaps::Pi() / 2. - </div><div id="ww1013228" class="NormalCode">                ll.y())) /</div><div id="ww1013229" class="NormalCode">            pow((1. - sinphi) / (1. +  sinphi),</div><div id="ww1013230" class="NormalCode">                0.5 * e));</div><div id="ww1013231" class="NormalCode">    ll.setY(-log(ll.y()));</div><div id="ww1013232" class="NormalCode">    </div><div id="ww1013233" class="NormalCode">    return IlvMaps::NoError();</div><div id="ww1013234" class="LastNormalCode">}</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>