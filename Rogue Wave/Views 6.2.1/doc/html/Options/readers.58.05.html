<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Shapefile Load-On-Demand</title><link rel="Prev" href="readers.58.04.html" title="Previous" /><link rel="Next" href="readers.58.06.html" title="Next" /><link rel="StyleSheet" href="css/readers.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/readers_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Options/readers.58.05.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pxbHFtGZUXKbey2wdR44KbQ" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Options/readers.58.05.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Options/docfrontcover.html#wwconnect_header">Maps</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/readers.58.01.html#wwconnect_header">Predefined Readers</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/readers.58.02.html#wwconnect_header">The Shapefile Reader</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Shapefile Load-On-Demand</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww1006926" class="Heading2"><span></span>Shapefile Load-On-Demand</div><div id="ww1006927" class="Body">The Maps module provides classes to perform the load-on-demand on Shapefiles. This is achieved by using specific spatial index files. These files, usually having an .<span class="code">idx </span>extension, store relations between tile and object identifiers that belong to these tiles. A class and a tool example are provided to generate these spatial index files. </div><div id="ww1008377" class="Body">The load-on-demand mechanism involves two classes in addition to the shape reader and the <span class="code">dbf</span> reader: the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvShapeFileIndex.html">IlvShapeFileIndex</a></span> class and the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvShapeSpatialIndex.html">IlvShapeSpatialIndex</a></span> class. A utility class is also provided to generate the spatial index for a given Shapefile: the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvShapeFileTiler.html">IlvShapeFileTiler</a></span> class.</div><div id="ww1008380" class="Body">The following diagram illustrates the mechanism used to store and retrieve objects by tiles:</div><div class="ww_skin_page_overflow"><div id="ww1006993" class="Startplain">       <img class="Default" src="../Options/images/TilesDiagram.gif" width="100%" style="display: block; left: 0.0pt; max-height: 465px; max-width: 607px; top: 0.0pt" alt="" /></div></div><div id="ww1006994" class="Body">The Spatial Index file holds object identifiers for each tile. Object identifiers have their ordinal place in the Index File. Geometries are retrieved in the Shapefile using the Index File. In this diagram, for example, the tile [2, 1] (tile indices begin at 0) contains identifiers 2, 5, and 9 referring to the geometries g2, g5, and g9 respectively.</div><div id="ww1006995" class="Body">The following classes are used to perform load-on-demand on the Shapefiles:</div><div id="ww1006999" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Options/readers.58.05.html#ww1007013" title="Shapefile Load-On-Demand">The IlvShapeFileIndex Class</a></div><div id="ww1007003" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Options/readers.58.05.html#ww1007026" title="Shapefile Load-On-Demand">The IlvShapeSpatialIndex Class</a></div><div id="ww1007007" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Options/readers.58.05.html#ww1007068" title="Shapefile Load-On-Demand">The IlvShapeFileTiler Class</a></div><div id="ww1007011" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Options/readers.58.05.html#ww1007254" title="Shapefile Load-On-Demand">The IlvShapeFileTileLoader Class</a></div><div id="ww1009328" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span><a href="../Options/readers.58.05.html#ww1007278" title="Shapefile Load-On-Demand">The IlvShapeLayer Class</a></div><div id="ww1007013" class="Heading3"><span></span>The IlvShapeFileIndex Class</div><div id="ww1007014" class="Body">This class allows you to directly access geometries in a Shapefile. The spatial index and the Shapefile must correspond to the same theme:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503937007874pt"><div id="ww1007110" class="CodeInTable">IlvMapsError status;</div><div id="ww1007111" class="CodeInTable">// Open the index file.</div><div id="ww1007112" class="CodeInTable">IlvShapeFileIndex* index =</div><div id="ww1007113" class="CodeInTable">    new IlvShapeFileIndex(shxFileName);</div><div id="ww1007114" class="CodeInTable">status = index-&gt;getInitStatus();</div><div id="ww1007115" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007116" class="CodeInTable">    return status;</div><div id="ww1007118" class="CodeInTable">// Open the corresponding Shapefile.</div><div id="ww1007119" class="CodeInTable">IlvShapeSHPReader* shape =</div><div id="ww1007120" class="CodeInTable">    new IlvShapeSHPReader(shpFileName);</div><div id="ww1007121" class="CodeInTable">status = shape-&gt;getInitStatus();    </div><div id="ww1007122" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007123" class="CodeInTable">    return status;</div><div id="ww1007125" class="CodeInTable">// Construct a reader from the Shapefile reader and the Shapefile index.</div><div id="ww1007126" class="CodeInTable">IlvShapeFileReader* reader =</div><div id="ww1007127" class="CodeInTable">    new IlvShapeFileReader(shape, 0, index);</div><div id="ww1007128" class="CodeInTable">status = reader-&gt;getInitStatus();</div><div id="ww1007129" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007130" class="CodeInTable">    return status;</div><div id="ww1007131" class="CodeInTable">    </div><div id="ww1007132" class="CodeInTable">// Retrieve the feature for each index.</div><div id="ww1007133" class="CodeInTable">IlInt count = index-&gt;getRecordCount();</div><div id="ww1007134" class="CodeInTable">for(IlInt i = 0; i &lt; count; i++) {</div><div id="ww1007135" class="CodeInTable">    const IlvMapFeature* feature = reader-&gt;getFeatureAt(i, status);</div><div id="ww1007136" class="CodeInTable">    if(status != IlvMaps::NoError())</div><div id="ww1007137" class="CodeInTable">        return status;</div><div id="ww1008043" class="CodeInTable">}</div></td></tr></table></div><div id="ww1007026" class="Heading3"><span></span>The IlvShapeSpatialIndex Class</div><div id="ww1007027" class="Body">This class stores tile information: tile size and count, identifiers of the objects belonging to each tile. To retrieve objects from a tile specified by its row and column, use the <span class="code">getIdArray()</span> method:  </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503937007874pt"><div id="ww1008045" class="CodeInTable">// Create a reader with the Shapefile name and the index file name.</div><div id="ww1008053" class="CodeInTable">IlvShapeFileReader* reader =</div><div id="ww1008046" class="CodeInTable">    new IlvShapeFileReader(shpFilename, 0, shxFilename);</div><div id="ww1007157" class="CodeInTable">// Open the spatial index.</div><div id="ww1007158" class="CodeInTable">IlvShapeSpatialIndex* spindex =</div><div id="ww1007159" class="CodeInTable">    new IlvShapeSpatialIndex(idxFileName);</div><div id="ww1007160" class="CodeInTable">status = spindex-&gt;getInitStatus();</div><div id="ww1007161" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007162" class="CodeInTable">    return status;</div><div id="ww1007164" class="CodeInTable">// Loop on all columns and rows.</div><div id="ww1007165" class="CodeInTable">for(int c = 0; c &lt; spindex-&gt;getColumnCount(); c++) {</div><div id="ww1007166" class="CodeInTable">    for(int r = 0; r &lt; spindex-&gt;getRowCount(); r++) {</div><div id="ww1007167" class="CodeInTable">        IlInt *ret;</div><div id="ww1007168" class="CodeInTable">        IlUInt size;</div><div id="ww1007169" class="CodeInTable">        // Retrieve the IDs of objects belonging to the tile</div><div id="ww1007170" class="CodeInTable">        // at column 'c' and row 'w'.</div><div id="ww1007171" class="CodeInTable">        status = spindex-&gt;getIdArray(c, r, ret, size);</div><div id="ww1007172" class="CodeInTable">        if(status != IlvMaps::NoError())</div><div id="ww1007173" class="CodeInTable">            return status;</div><div id="ww1007174" class="CodeInTable">        // Loop on these IDs and retrieve the corresponding map feature.</div><div id="ww1007175" class="CodeInTable">        for(int i = 0; i &lt; size; i++) {</div><div id="ww1007176" class="CodeInTable">            const IlvMapFeature* feature = </div><div id="ww1007194" class="CodeInTable">                reader-&gt;getFeatureAt(ret[i], status);</div><div id="ww1007177" class="CodeInTable">        if(status != IlvMaps::NoError())</div><div id="ww1007178" class="CodeInTable">            return status;</div><div id="ww1007179" class="CodeInTable">      }</div><div id="ww1007180" class="CodeInTable">      // Free allocated array.</div><div id="ww1007181" class="CodeInTable">      if(ret)</div><div id="ww1007182" class="CodeInTable">         delete[] ret;</div><div id="ww1007183" class="CodeInTable">    }</div><div id="ww1007184" class="CodeInTable">}</div></td></tr></table></div><div id="ww1007066" class="Body">This class can also be used to generate your own tiling information for a given Shapefile:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503937007874pt"><div id="ww1007198" class="CodeInTable">IlvShapeSpatialIndex* tilerIndex = new </div><div id="ww1007234" class="CodeInTable">    IlvShapeSpatialIndex(getColumnCount(),</div><div id="ww1007199" class="CodeInTable">                         getRowCount(),</div><div id="ww1007200" class="CodeInTable">                         getOrigin(),</div><div id="ww1007201" class="CodeInTable">                         getTileWidth(),</div><div id="ww1007202" class="CodeInTable">                         getTileHeight());</div><div id="ww1007203" class="CodeInTable">status = tilerIndex-&gt;getInitStatus();</div><div id="ww1007204" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007205" class="CodeInTable">    return status;</div><div id="ww1007206" class="CodeInTable">IlvMapFeature* feature = (IlvMapFeature*)reader-&gt;getNextFeature(status);</div><div id="ww1007207" class="CodeInTable">if(status != IlvMaps::NoError())</div><div id="ww1007208" class="CodeInTable">    return status;</div><div id="ww1007209" class="CodeInTable">int id = 0;</div><div id="ww1007210" class="CodeInTable">while(feature) {</div><div id="ww1007211" class="CodeInTable">    // Determine to which tile(s) the object must belong.</div><div id="ww1007212" class="CodeInTable">    int row = getRow(feature);</div><div id="ww1007213" class="CodeInTable">    int col = getColumn(feature);</div><div id="ww1007214" class="CodeInTable">    // Add it to the spatial index.</div><div id="ww1007215" class="CodeInTable">    tilerIndex-&gt;add(row, col, id);</div><div id="ww1007216" class="CodeInTable">    feature = (IlvMapFeature*)reader-&gt;getNextFeature(status);</div><div id="ww1007217" class="CodeInTable">    if(status != IlvMaps::NoError())</div><div id="ww1007218" class="CodeInTable">        return status;</div><div id="ww1007219" class="CodeInTable">    id++;</div><div id="ww1007220" class="CodeInTable">}</div><div id="ww1007221" class="CodeInTable">// Write the spatial index.</div><div id="ww1007222" class="CodeInTable">tilerIndex-&gt;save("spatialIndex.idx");</div></td></tr></table></div><div id="ww1007068" class="Heading3"><span></span>The IlvShapeFileTiler Class</div><div id="ww1007069" class="Body">This class is used to generate tiling information from a given Shapefile. To use this class you have to provide the Shapefile to tile, the Spatial Index File to write to, and the tile size.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503937007874pt"><div id="ww1007072" class="CodeInTable">IlvShapeFileTiler::CreateShapeSpatialIndex("example.shp", </div><div id="ww1007073" class="CodeInTable">                                           "example.idx", </div><div id="ww1007074" class="CodeInTable">                                            (IlDouble)5, (IlDouble)10);</div></td></tr></table></div><div id="ww1007246" class="Body">The above code extract will produce a Spatial Index File named <span class="code">example.idx</span> with a tile size of width 5 and height 10. For example, if the upper left corner of the <span class="code">example.shp</span> file is (x = -5, y = 20), and if the lower right corner is (x = 35, y = -30), the resulting tiling array will be 8 columns by 5 rows</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 368.503937007874pt"><div id="ww1007249" class="CodeInTable">IlvShapeFileTiler::CreateShapeSpatialIndex("example.shp", </div><div id="ww1007250" class="CodeInTable">                                           "example.idx", </div><div id="ww1007251" class="CodeInTable">                                           (IlInt)20, (IlInt)30);</div></td></tr></table></div><div id="ww1007252" class="Body">The above code extract will produce a Spatial Index File of 600 tiles, 20 columns, and 30 rows.</div><div id="ww1007254" class="Heading3"><span></span>The IlvShapeFileTileLoader Class</div><div id="ww1007084" class="Body">This class implements load-on-demand for tiled Shapefiles. When associated with an <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTiledLayer.html">IlvTiledLayer</a></span>, this class automatically handles tile loading if the Shapefile name, the Index File name, and the Spatial Index File name are provided. An optional Dbase file name can also be provided to load object attributes.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007325" class="CodeInTable">IlvMapAdapter a(0.001);</div><div id="ww1007326" class="CodeInTable">IlvShapeFileTileLoader* tileLoader = </div><div id="ww1007327" class="CodeInTable">    new IlvShapeFileTileLoader(shpFileName,</div><div id="ww1007328" class="CodeInTable">                               dbfFileName, // or null if attribute</div><div id="ww1007341" class="CodeInTable">                                            // loading is not wanted.</div><div id="ww1007330" class="CodeInTable">                               shxFileName,</div><div id="ww1007331" class="CodeInTable">                               idxFileName,</div><div id="ww1007332" class="CodeInTable">                               &amp;a);</div><div id="ww1007333" class="CodeInTable">IlvTiledLayer* tiledLayer = new IlvTiledLayer(getTileOrigin());</div><div id="ww1007280" class="CodeInTable">tiledLayer-&gt;setTileLoader(tileLoader);</div></td></tr></table></div><div id="ww1007278" class="Heading3"><span></span>The IlvShapeLayer Class</div><div id="ww1007366" class="Body">The <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvShapeFileLayer.html">IlvShapeFileLayer</a></span> class is an <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTiledLayer.html">IlvTiledLayer</a></span> that can be saved in an <span class="code">.ilv</span> file. In particular, it handles all the mechanisms to properly restart the load-on-demand layer when this layer is read from an <span class="code">.ilv</span> file.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007369" class="CodeInTable">IlvMapAdapter a(0.001);</div><div id="ww1007370" class="CodeInTable">IlvShapeFileTileLoader* tileLoader = </div><div id="ww1007371" class="CodeInTable">    new IlvShapeFileTileLoader(shpFileName,</div><div id="ww1007372" class="CodeInTable">                               dbfFileName, // or null if attribute</div><div id="ww1007373" class="CodeInTable">                                            // loading is not wanted.</div><div id="ww1007374" class="CodeInTable">                               shxFileName,</div><div id="ww1007375" class="CodeInTable">                               idxFileName,</div><div id="ww1007376" class="CodeInTable">                               &amp;a);</div><div id="ww1007377" class="CodeInTable">IlvShapeFileLayer* shapeLayer = new IlvShapeFileLayer(tileLoader);</div><div id="ww1007378" class="CodeInTable">IlvManager* manager = new IlvManager(0);</div><div id="ww1007379" class="CodeInTable">manager-&gt;addLayer(shapeLayer);</div><div id="ww1007380" class="CodeInTable">manager-&gt;save(ofstream("out.ilv"));</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>