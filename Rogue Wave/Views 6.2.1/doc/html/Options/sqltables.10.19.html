<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Transaction Manager</title><link rel="Prev" href="sqltables.10.18.html" title="Previous" /><link rel="Next" href="sqltables.10.20.html" title="Next" /><link rel="StyleSheet" href="css/sqltables.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/sqltables_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Options/sqltables.10.19.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pfl7ty5O7FeHlsDWq6U5izA" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Options/sqltables.10.19.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Options/dausrfrontcover.html#wwconnect_header">Data Access User Manual</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/dausrpart2.html#ww144909">Data Access and SQL</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/sqltables.10.01.html#wwconnect_header">SQL Tables</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Transaction Manager</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww1002898" class="Heading1"><span></span>Transaction Manager</div><div id="ww1002899" class="Body">The <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliTransactionManager.html">IliTransactionManager</a></span> class manages so-called local transactions in which the propagation of changes of one or more <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliTable.html">IliTable</a></span> objects is deferred. This is especially useful when using <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliSQLTable.html">IliSQLTable</a></span> objects. In effect, each time a row is inserted, updated, or deleted in an <span class="code">IliSQLTable</span> object, one or more corresponding SQL statements are submitted to the database server to which the SQL table object is connected.</div><div id="ww1002900" class="Body">Although it is necessary to send SQL statements immediately when the <span class="code">IliSQLTable</span> object is in auto-commit mode, it can be useful to retain these statements when not in auto-commit mode. Instead, the user could be allowed to make a number of changes to one or more <span class="code">IliSQLTable</span> objects. The changes would be effective in local row cache so that they are reflected in all connected gadgets, but the corresponding SQL statements are retained. Later, when the user validates the changes, all SQL statements are submitted to the database server.</div><div id="ww1002901" class="Body">If all statements are accepted by the server, the transaction has succeeded and the user can issue a database commit. However, if at least one of the statements fails, the user should issue a database rollback to cancel any statement that would have succeeded before it. The user can then either make some additional changes and retry the validation process or cancel all changes locally so that the local row cache(s) of the <span class="code">IliSQLTable</span> object(s) revert their state(s) to what they were before the first change.</div><div id="ww1002902" class="Body">The set of changes that have been effected in the local row cache(s) of the <span class="code">IliSQLTable</span> object(s) and the corresponding SQL statements that have been retained are called a local transaction. </div><div id="ww1002903" class="Body">To participate in a local transaction, an <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliTable.html">IliTable</a></span> object must be managed by an instance of the <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliTransactionManager.html">IliTransactionManager</a></span> class.</div><div id="ww1002904" class="Body">A transaction manager is anonymous or named. The name space for a transaction manager is global. There can be at most one transaction manager with a given name.</div><div id="ww1002905" class="Body">The simplest way to assign a transaction manager to an <span class="code">IliTable</span> object is to assign its <span class="code">transactionManagerName</span> property. If a name is assigned to the property and there is no transaction manager with that name, a transaction manager is automatically created and is assigned to the <span class="code">IliTable</span> object. Other table objects can then be made to share this transaction manager by assigning the same name to their <span class="code">transactionManagerName</span> property. The transaction manager can then be obtained by accessing the <span class="code">transactionManager</span> property of one of the table objects. </div><div id="ww1002906" class="Body">The <span class="code">IliSQLTable</span> and <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliMemoryTable.html">IliMemoryTable</a></span><span class="code"> </span>classes are currently transaction-manager-aware classes.</div><div id="ww1002907" class="Body">Note that the following restrictions apply to the use of a transaction manager:</div><div id="ww1002908" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliTable.html">IliTable</a></span><span class="code">::select</span> and <span class="code">IliTable::clearRows</span> member functions should not be called on table objects involved in a pending local transaction.</div><div id="ww1002909" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>Nested tables should not be managed by a transaction manager. See the <a href="../Options/sqltables.10.18.html#ww1002066" title="Parameters">Parameters</a> for more information.</div><div id="ww1002916" class="Body">The following code sample shows how a transaction manager is used: </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1006265" class="CodeInTable">class MyPanel: public IlvGadgetContainer {</div><div id="ww1006266" class="CodeInTable">public:</div><div id="ww1006267" class="CodeInTable">  IliSQLTable* getTableEMP() const { ... }</div><div id="ww1006268" class="CodeInTable">  IliSQLTable* getTableDEPT() const { ... }</div><div id="ww1006269" class="CodeInTable">&nbsp;</div><div id="ww1006270" class="CodeInTable">  MyPanel(IlvDisplay* dpy) </div><div id="ww1006271" class="CodeInTable">    : IlvGadgetContainer(dpy, ...)</div><div id="ww1006272" class="CodeInTable">    { ... }</div><div id="ww1006273" class="CodeInTable">&nbsp;</div><div id="ww1006274" class="CodeInTable">void initPanel() {</div><div id="ww1006275" class="CodeInTable">    // Could be done in Rogue Wave&nbsp;Views<span style="font-family: &quot;Times New Roman&quot;; font-size: 10.0pt"> Studio</span> without coding,</div><div id="ww1006276" class="CodeInTable">    // shown here for exposition.</div><div id="ww1006277" class="CodeInTable">    // Ensure both tables are using the same transaction manager.</div><div id="ww1006278" class="CodeInTable">    getTableEMP()-&gt;setTransactionManagerName("TRANS_MGR");</div><div id="ww1006279" class="CodeInTable">    getTableDEPT()-&gt;setTransactionManagerName("TRANS_MGR");</div><div id="ww1006280" class="CodeInTable">&nbsp;</div><div id="ww1006281" class="CodeInTable">    // And the same session.</div><div id="ww1006282" class="CodeInTable">    IliSQLSession* session = getTableEMP()-&gt;getSQLSession();</div><div id="ww1006283" class="CodeInTable">    getTableDEPT()-&gt;setSQLSession(session);</div><div id="ww1006284" class="CodeInTable">&nbsp;</div><div id="ww1006285" class="CodeInTable">    // Do not auto-commit.</div><div id="ww1006286" class="CodeInTable">    getTableEMP()-&gt;setAutoCommit(IlvFalse);</div><div id="ww1006287" class="CodeInTable">    getTableDEPT()-&gt;setAutoCommit(IlvFalse);</div><div id="ww1006288" class="CodeInTable">  }</div><div id="ww1006289" class="CodeInTable">&nbsp;</div><div id="ww1006290" class="CodeInTable">  IliTransactionManager* getTransMgr() const</div><div id="ww1006291" class="CodeInTable">    { return getTableEMP()-&gt;getTransactionManager(); }</div><div id="ww1006292" class="CodeInTable">&nbsp;</div><div id="ww1006293" class="CodeInTable">  IliSQLSession* getSQLSession() const</div><div id="ww1006294" class="CodeInTable">    { return getTableEMP()-&gt;getEffectiveSQLSession(); }</div><div id="ww1006295" class="CodeInTable">&nbsp;</div><div id="ww1006296" class="CodeInTable">&nbsp;</div><div id="ww1006297" class="CodeInTable">  IlBoolean isTransactionStarted() const </div><div id="ww1006298" class="CodeInTable">    { return getTransMgr()-&gt;isStarted(); }</div><div id="ww1006299" class="CodeInTable">&nbsp;</div><div id="ww1006300" class="CodeInTable">  void startTransaction()</div><div id="ww1006301" class="CodeInTable">    { getTransMgr()-&gt;start(); }</div><div id="ww1006302" class="CodeInTable">&nbsp;</div><div id="ww1006303" class="CodeInTable">  IlBoolean acceptTransaction() {</div><div id="ww1006304" class="CodeInTable">    if (getTransMgr()-&gt;accept()) {</div><div id="ww1006305" class="CodeInTable">      getTransMgr()-&gt;stop();</div><div id="ww1006306" class="CodeInTable">      getSQLSession()-&gt;commit();</div><div id="ww1006307" class="CodeInTable">      return IlTrue;</div><div id="ww1006308" class="CodeInTable">    }</div><div id="ww1006309" class="CodeInTable">    else {</div><div id="ww1006310" class="CodeInTable">      getSQLSession()-&gt;rollback();</div><div id="ww1006311" class="CodeInTable">      return IlFalse;</div><div id="ww1006312" class="CodeInTable">    }</div><div id="ww1006313" class="CodeInTable">  }</div><div id="ww1006314" class="CodeInTable">&nbsp;</div><div id="ww1006315" class="CodeInTable">  void cancelTransaction() {</div><div id="ww1006316" class="CodeInTable">    getTransMgr()-&gt;cancel(); </div><div id="ww1006317" class="CodeInTable">    getTransMgr()-&gt;stop();</div><div id="ww1006318" class="CodeInTable">  }</div><div id="ww1006319" class="CodeInTable">};</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright Â© 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>