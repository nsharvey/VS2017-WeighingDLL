<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Writing a New Cache Algorithm</title><link rel="Prev" href="loadondemand.57.12.html" title="Previous" /><link rel="Next" href="loadondemand.57.14.html" title="Next" /><link rel="StyleSheet" href="css/loadondemand.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/loadondemand_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Options/loadondemand.57.13.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pUpR4aO9zHBIr9T2lr9_002bN7Q" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Options/loadondemand.57.13.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Options/docfrontcover.html#wwconnect_header">Maps</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/loadondemand.57.01.html#wwconnect_header">Using Load-On-Demand</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Writing a New Cache Algorithm</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww999042" class="Heading1"><span></span>Writing a New Cache Algorithm</div><div id="ww999053" class="Body">This section explains how to write a customized cache algorithm to meet specific application requirements. The example in this section is a simplified version of the class  <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvDefaultTileCache.html">IlvDefaultTileCache</a></span> provided in the Rogue Wave®&nbsp;Views Maps library. The complete source code for this example can be found in the following file. </div><div id="ww999060" class="Body">The class <span class="code">SimpleTileCache</span> extends the class <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTileCache.html">IlvTileCache</a></span>. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007095" class="CodeInTable">&nbsp;</div><div id="ww1007096" class="CodeInTable">class TileCache</div><div id="ww1007097" class="CodeInTable">    :public IlvTileCache</div><div id="ww1007098" class="CodeInTable">{</div><div id="ww1007099" class="CodeInTable">public:</div><div id="ww1007100" class="CodeInTable">    TileCache(int size);</div><div id="ww1007101" class="CodeInTable">    TileCache::TileCache(IlvInputFile&amp; file);</div><div id="ww1007102" class="CodeInTable">    virtual void tileAboutToLoad(IlvTile *);    </div><div id="ww1007103" class="CodeInTable">    virtual void tileCached(IlvTile *);</div><div id="ww1007104" class="CodeInTable">    virtual void tileRetrieved(class IlvTile *);</div><div id="ww1007105" class="CodeInTable">    virtual void controllerDeleted(IlvTileController *);</div><div id="ww1007106" class="CodeInTable">    virtual void write(IlvOutputFile&amp; output) const;</div><div id="ww1007107" class="CodeInTable">private:</div><div id="ww1007108" class="CodeInTable">    int _size;</div><div id="ww1007109" class="CodeInTable">    IlList _tiles;</div><div id="ww1007110" class="CodeInTable">};</div><div id="ww1006787" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999084" class="Body"><span class="code">_size</span> defines the maximum number of tiles that can be stored in the cache. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007114" class="CodeInTable">&nbsp;</div><div id="ww1007115" class="CodeInTable">TileCache::TileCache(int size)</div><div id="ww1007116" class="CodeInTable">    :IlvTileCache(),</div><div id="ww1007117" class="CodeInTable">     _size(size)</div><div id="ww1007118" class="CodeInTable">{</div><div id="ww1007119" class="CodeInTable">}</div><div id="ww1006798" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999093" class="Body">The <span class="code">TileCache</span> constructor creates an instance of the default cache with the specified size. </div><div id="ww999100" class="Body">The following constructor reads the cache from the provided input stream. Caches created using this constructor are persistent and can thus be saved with an <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTiledLayer.html">IlvTiledLayer</a></span> object.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007123" class="CodeInTable">&nbsp;</div><div id="ww1007124" class="CodeInTable">TileCache::TileCache(IlvInputFile&amp; file)</div><div id="ww1007125" class="CodeInTable">    :IlvTileCache()</div><div id="ww1007126" class="CodeInTable">{</div><div id="ww1007127" class="CodeInTable">    file.getStream() &gt;&gt; _size;</div><div id="ww1007128" class="CodeInTable">}</div><div id="ww1006809" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999110" class="Body">The <span class="code">write</span> method writes the cache to an output stream. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007132" class="CodeInTable">&nbsp;</div><div id="ww1007133" class="CodeInTable">void</div><div id="ww1007134" class="CodeInTable">TileCache::write(IlvOutputFile&amp; output)  const</div><div id="ww1007135" class="CodeInTable">{</div><div id="ww1007136" class="CodeInTable">    output.getStream() &lt;&lt; _size;</div><div id="ww1007137" class="CodeInTable">}</div><div id="ww1006820" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999118" class="Body">The following method belongs to the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTileCache.html">IlvTileCache</a></span> interface. It is called when a tile is cached. In this implementation, the tile is added at the end of the internal tile list. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007141" class="CodeInTable">&nbsp;</div><div id="ww1007142" class="CodeInTable">void</div><div id="ww1007143" class="CodeInTable">TileCache::tileCached(IlvTile *tile)</div><div id="ww1007144" class="CodeInTable">{</div><div id="ww1007145" class="CodeInTable">    _tiles.append(tile);</div><div id="ww1007146" class="CodeInTable">}</div><div id="ww1006831" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999132" class="Body">The following method belongs to the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTileCache.html">IlvTileCache</a></span> interface. It is called when a tile is removed from the cache and locked again. With this implementation, the tile is removed from the internal tile list.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007180" class="CodeInTable">&nbsp;</div><div id="ww1007181" class="CodeInTable">void</div><div id="ww1007182" class="CodeInTable">TileCache::tileRetrieved(IlvTile* tile)</div><div id="ww1007183" class="CodeInTable">{</div><div id="ww1007184" class="CodeInTable">    _tiles.remove(tile);</div><div id="ww1007185" class="CodeInTable">}</div><div id="ww1006874" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999139" class="Body">The following method belongs to the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTileCache.html">IlvTileCache</a></span> abstract class. It is called when a tile is about to be loaded. With this implementation, if the number of tiles in the cache exceeds the cache size, the least recently used tiles, at the top the internal tile list, will be unloaded to make room for new tiles. </div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007227" class="CodeInTable">&nbsp;</div><div id="ww1007228" class="CodeInTable">void</div><div id="ww1007229" class="CodeInTable">TileCache::tileAboutToLoad(IlvTile *tile)</div><div id="ww1007230" class="CodeInTable">{</div><div id="ww1007231" class="CodeInTable">    int toRemove = _tiles.length() - _size;</div><div id="ww1007232" class="CodeInTable">    if (toRemove &lt;= 0)</div><div id="ww1007233" class="CodeInTable">      return;</div><div id="ww1007234" class="CodeInTable">    for (int i = toRemove; i &gt; 0; i--) {</div><div id="ww1007235" class="CodeInTable">        IlvTile* current = (IlvTile*)_tiles[0];</div><div id="ww1007236" class="CodeInTable">        _tiles.remove(current);</div><div id="ww1007237" class="CodeInTable">        releaseTile(current);</div><div id="ww1007238" class="CodeInTable">    }</div><div id="ww1007239" class="CodeInTable">}</div><div id="ww1006934" class="CodeInTable">&nbsp;</div></td></tr></table></div><div id="ww999168" class="Body">The following method belongs to the <span class="ClassName"><a href="../RefMan/refcppmaps/classIlvTileCache.html">IlvTileCache</a></span> abstract class. It is called when a tiled layer is taken out of the manager to remove the tiles managed by its tile controller from the cache.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1007243" class="CodeInTable">&nbsp;</div><div id="ww1007244" class="CodeInTable">void</div><div id="ww1007245" class="CodeInTable">TileCache::controllerDeleted(IlvTileController* controller)</div><div id="ww1007246" class="CodeInTable">{</div><div id="ww1007247" class="CodeInTable">    IlvLink* l;</div><div id="ww1007248" class="CodeInTable">    l = _tiles.getFirst();</div><div id="ww1007249" class="CodeInTable">    IlvTile* tile;</div><div id="ww1007250" class="CodeInTable">    while (l) {</div><div id="ww1007251" class="CodeInTable">        tile = (IlvTile*) l-&gt;getValue();</div><div id="ww1007252" class="CodeInTable">        l = l-&gt;getNext();</div><div id="ww1007253" class="CodeInTable">        if (tile-&gt;getController() == controller)</div><div id="ww1007254" class="CodeInTable">            _tiles.remove(tile);</div><div id="ww1007255" class="CodeInTable">    }</div><div id="ww1007256" class="CodeInTable">}</div><div id="ww1006953" class="CodeInTable">&nbsp;</div></td></tr></table></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>