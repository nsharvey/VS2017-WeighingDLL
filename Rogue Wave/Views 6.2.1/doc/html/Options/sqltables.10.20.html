<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- RW Customization - favicon file --><link rel="shortcut icon" href="connect/favicon.ico" /><title>Structured Types</title><link rel="Prev" href="sqltables.10.19.html" title="Previous" /><link rel="Next" href="sqltables.10.21.html" title="Next" /><link rel="StyleSheet" href="css/sqltables.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/sqltables_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/custom.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../views.html#page/Options/sqltables.10.20.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-111257570-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body id="pvbI1ITm4V1zSDKZZW3WNBQ" class="ww_skin_page_body" onload="Page.OnLoad('../views.html#page/Options/sqltables.10.20.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Options/dausrfrontcover.html#wwconnect_header">Data Access User Manual</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/dausrpart2.html#ww144909">Data Access and SQL</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_parent"><a href="../Options/sqltables.10.01.html#wwconnect_header">SQL Tables</a></span><span class="ww_skin_breadcrumbs_divider"> &gt; </span><span class="ww_skin_breadcrumbs_current">Structured Types</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="ww1002994" class="Heading1"><span></span>Structured Types</div><div id="ww1002995" class="Body">Some database systems (for example, Oracle 9i  or later, Informix 9.x) support extensible type systems in which the type of a database table column is not limited to the traditional scalar data types. It can also be either a structured type or a collection type.</div><div id="ww1002996" class="Body">Data Access represents values of the structured types as <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliMemoryTable.html">IliMemoryTable</a></span> objects.</div><div id="ww1002997" class="Body">For example, a database table called PRODUCT can be defined in an Oracle 8.x database system as follows:</div><div id="ww1002998" class="NormalCode">CREATE TYPE PART_T AS OBJECT(</div><div id="ww1002999" class="NormalCode">  PARTNO INTEGER NOT NULL,</div><div id="ww1003000" class="NormalCode">  PARTNAME VARCHAR(20) NOT NULL);</div><div id="ww1003001" class="NormalCode">&nbsp;</div><div id="ww1003002" class="NormalCode">CREATE TYPE PART_TABLE_T AS TABLE OF PART_T;</div><div id="ww1003003" class="NormalCode">&nbsp;</div><div id="ww1003004" class="NormalCode">CREATE TABLE PRODUCT(</div><div id="ww1003005" class="NormalCode">  PRODNO INTEGER NOT NULL PRIMARY KEY,</div><div id="ww1003006" class="NormalCode">  PRODNAME VARCHAR2(50) NOT NULL,</div><div id="ww1003007" class="LastNormalCode">  PARTS PART_TABLE_T);</div><div id="ww1003009" class="Body">An SQL data source named PRODUCT_DS based on the PRODUCT table can then be created. All three columns of the PRODUCT table should be included in the PRODUCT_DS data source.</div><div id="ww1003010" class="Body">The following code extract shows how the contents of the PARTS column can be used in Rogue Wave&nbsp;Script.</div><div id="ww1003011" class="NormalCode">IliSQLDataSource prodDS = ...;</div><div id="ww1003012" class="NormalCode">IliSQLTable* prodTable = prodDS-&gt;getSQLTable();</div><div id="ww1003013" class="NormalCode">for (IlInt prodIdx = 0; prodIdx &lt; prodTable-&gt;getRowsCount(); ++prodIdx) {</div><div id="ww1003014" class="NormalCode">  const IliTable* partsTable = prodTable-&gt;at(prodIdx, "PARTS").asTable();</div><div id="ww1003015" class="NormalCode">  const char* prodName = prodTable-&gt;at(prodIdx, "PRODNAME");</div><div id="ww1003016" class="NormalCode">  if (partsTable != NULL) {</div><div id="ww1003017" class="NormalCode">    IlvPrint("Product %s parts:", prodName);</div><div id="ww1003018" class="NormalCode">    IlInt partCount = partsTable-&gt;getRowsCount();</div><div id="ww1003019" class="NormalCode">    for (IlInt partIdx = 0; partIdx &lt; partCount; ++partIdx) {</div><div id="ww1003020" class="NormalCode">        const char* partName = partsTable-&gt;at(partIdx, "PARTNAME");</div><div id="ww1003021" class="NormalCode">        IlvPrint(" %s", partName);</div><div id="ww1003022" class="NormalCode">    }</div><div id="ww1003023" class="NormalCode">  }</div><div id="ww1003024" class="NormalCode">  else</div><div id="ww1003025" class="NormalCode">  IlvPrint("Product %s does not have parts", prodName);</div><div id="ww1003026" class="LastNormalCode">}</div><div id="ww1003028" class="Body">The following code extract shows how a new row can be inserted in the PRODUCT table.</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 371.338299212598pt"><div id="ww1006354" class="CodeInTable">IliSQLDataSource prodDS = ...;</div><div id="ww1006355" class="CodeInTable">IliSQLTable* prodTable = prodDS-&gt;getSQLTable();</div><div id="ww1006356" class="CodeInTable">&nbsp;</div><div id="ww1006357" class="CodeInTable">// Create the nested PARTS table.</div><div id="ww1006358" class="CodeInTable">IlInt partsColno = prodTable-&gt;getColumnIndex("PARTS");</div><div id="ww1006359" class="CodeInTable">const IliDatatype* type = prodTable-&gt;getColumnType(partsColno);</div><div id="ww1006360" class="CodeInTable">IliTable* partsTable = type-&gt;makeTable();</div><div id="ww1006361" class="CodeInTable">partsTable-&gt;lock();</div><div id="ww1006362" class="CodeInTable">&nbsp;</div><div id="ww1006363" class="CodeInTable">IliTableBuffer* partsBuf = partsTable-&gt;getBuffer();</div><div id="ww1006364" class="CodeInTable">&nbsp;</div><div id="ww1006365" class="CodeInTable">// Insert the first part.</div><div id="ww1006366" class="CodeInTable">partsBuf-&gt;at("PARTNO") = (IlInt)610;</div><div id="ww1006367" class="CodeInTable">partsBuf-&gt;at("PARTNAME") = "Drawer";</div><div id="ww1006368" class="CodeInTable">partsTable-&gt;appendRow(partsBuf);</div><div id="ww1006369" class="CodeInTable">&nbsp;</div><div id="ww1006370" class="CodeInTable">// Insert the second part.</div><div id="ww1006371" class="CodeInTable">partsBuf-&gt;at("PARTNO") = (IlInt)611;</div><div id="ww1006372" class="CodeInTable">partsBuf-&gt;at("PARTNAME") = "Handle";</div><div id="ww1006373" class="CodeInTable">partsTable-&gt;appendRow(partsBuf);</div><div id="ww1006374" class="CodeInTable">&nbsp;</div><div id="ww1006375" class="CodeInTable">partsTable-&gt;releaseBuffer(partsBuf);</div><div id="ww1006376" class="CodeInTable">&nbsp;</div><div id="ww1006377" class="CodeInTable">// Insert the new product.</div><div id="ww1006378" class="CodeInTable">IliTableBuffer* prodBuf = prodTable-&gt;getBuffer();</div><div id="ww1006379" class="CodeInTable">prodBuf-&gt;at("PRODNO") = (IlInt)61;</div><div id="ww1006380" class="CodeInTable">prodBuf-&gt;at("PRODNAME") = "Dresser";</div><div id="ww1006381" class="CodeInTable">prodBuf-&gt;at("PRODNAME") = partsTable;</div><div id="ww1006382" class="CodeInTable">prodTable-&gt;appendRow(prodBuf);</div><div id="ww1006383" class="CodeInTable">prodTable-&gt;releaseBuffer(prodBuf);</div><div id="ww1006384" class="CodeInTable">&nbsp;</div><div id="ww1006385" class="CodeInTable">partsTable-&gt;unLock();</div></td></tr></table></div><div id="ww1003062" class="Body">In both examples shown above, <span class="code">prodTable</span> designates an <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliSQLTable.html">IliSQLTable</a></span> whereas <span class="code">partsTable</span> designates a nested <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliMemoryTable.html">IliMemoryTable</a></span>. Care must be taken not to modify the nested memory table. Doing so would inevitably lead to inconsistencies between the Data Access application and the database. Instead, a PARTS_DS SQL data source based on the PRODUCTS.PARTS nested table can be created. This data source is defined as follows through the SQL Data Source inspector: </div><div id="ww1003064" class="Numbered1"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">1.	</span></span>Set the data source name to PARTS_DS.</div><div id="ww1003065" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">2.	</span></span>Add the PRODUCT database table by selecting Add Tables... from the Query menu of the inspector panel.</div><div id="ww1003066" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">3.	</span></span>In the PRODUCT table, open the PARTS column by clicking on the + sign that appears to the left of the column name.</div><div id="ww1003067" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">4.	</span></span>Drag the PARTNO and PARTNAME columns and drop them in the SELECT section.</div><div id="ww1003068" class="Numbered"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span class="number">5.	</span></span>To edit the definition of the PRODUCT table, double-click on the PRODUCT table. In the Table definition dialog box that appears, make sure that the following items are defined:</div><div id="ww1003069" class="IndentedL1">Parent: <span class="code">PRODUCT_DS</span></div><div id="ww1003070" class="IndentedL1">Alias: <span class="code">PRODUCT</span></div><div id="ww1003071" class="Body">The PARTS_DS data source can be used in two different settings:</div><div id="ww1003072" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The PRODUCT_DS data source does not include the PARTS column. Instead, the PARTS_DS data source retrieves the contents of the nested PARTS table each time its <span class="code">select</span> method is called. Note that in this case, there are no nested <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliMemoryTable.html">IliMemoryTable</a></span> objects involved. Instead there are two <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliSQLTable.html">IliSQLTable</a></span> objects, one of them belongs to PRODUCT_DS and the second one belongs to PARTS_DS.</div><div id="ww1003074" class="Itemize"><span class="WebWorks_Number" style="width: 14.173228346456696pt"><span><img src="bullet.gif" alt="*" border="0" width="8" height="8" /></span></span>The PRODUCT_DS data source does include the PARTS column. Consequently, there are many nested <span class="ClassName"><a href="../RefMan/refcppdataccess/classIliMemoryTable.html">IliMemoryTable</a></span> available, one for each row in the PRODUCT_DS data source. The PARTS_DS data source can be used in this setting to edit any nested <span class="code">partsTable</span> <span class="code">IliMemoryTable</span> objects contained in the PRODUCT_DS data source as shown in the following code extract:</div><div class="ww_skin_page_overflow"><table class="CodeTable" cellspacing="0" summary=""><tr><td style="background-color: #E0E0E0; padding-bottom: 2pt; padding-left: 0pt; padding-right: 0pt; padding-top: 2pt; vertical-align: top; width: 354.33042519685pt"><div id="ww1006412" class="CodeInTable">partsMemoryTable-&gt;Lock();</div><div id="ww1006413" class="CodeInTable">IliSQLDataSource* prodDS = ...;</div><div id="ww1006414" class="CodeInTable">IliSQLTable* prodTable = prodDS-&gt;getSQLTable();</div><div id="ww1006415" class="CodeInTable">IlInt prodIdx = prodDS-&gt;getCurrentRow();</div><div id="ww1006416" class="CodeInTable">&nbsp;</div><div id="ww1006417" class="CodeInTable">const IliTable* partsMemoryTable = prodTable-&gt;at(prodIdx,</div><div id="ww1006418" class="CodeInTable">                                                 "PARTS").asTable();</div><div id="ww1006419" class="CodeInTable">if (partsMemoryTable == NULL) {</div><div id="ww1006420" class="CodeInTable">  IlInt partsColno = prodTable-&gt;getColumnIndex(""PARTS");</div><div id="ww1006421" class="CodeInTable">  const IliDatatype* type = prodTable-&gt;getColumnType(partsColno);</div><div id="ww1006422" class="CodeInTable">  partsMemoryTable = type-&gt;makeTable();</div><div id="ww1006423" class="CodeInTable">  prodTable-&gt;set(prodIdx, "PARTS", IliValue(partsMemoryTable);</div><div id="ww1006424" class="CodeInTable">  partsMemoryTable = prodTable-&gt;at(prodIdx, "PARTS").asTable();</div><div id="ww1006425" class="CodeInTable">}</div><div id="ww1006426" class="CodeInTable">&nbsp;</div><div id="ww1006427" class="CodeInTable">IliSQLDataSource* partsDS = ...;</div><div id="ww1006428" class="CodeInTable">IliSQLTable* partsSQLTable = partsDS-&gt;getSQLTable();</div><div id="ww1006429" class="CodeInTable">partsSQLTable-&gt;setCache(partsMemoryTable);</div><div id="ww1006430" class="CodeInTable">partsMemoryTable-&gt;unLock();</div></td></tr></table></div><div id="ww1003095" class="Body">Once the nested memory table has been assigned to the cache property of the PARTS_DS table, it can be edited as any SQL table through PARTS_DS.</div><div id="ww1003096" class="Body">Note that the PARTS_DS data source assumes that the nested table it is editing belongs to the current row of the PRODUCT_DS data source. As a consequence, it is necessary to adjust the value of the cache property when the PRODUCT_DS data source moves to another row.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><div class="ww_skin_page_globalization"><div id="google_translate_element">&nbsp;</div><script><!--
            function googleTranslateElementInit() {
              new google.translate.TranslateElement({
                  pageLanguage: '',
                  autoDisplay: true
                }, 'google_translate_element');
            }
// --></script></div><br /></footer><HR /><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Version 6.2.1</div><div style="font-size: 8pt; font-family: verdana; font-weight: normal; text-align: center;">Copyright © 2018, Rogue Wave Software, Inc. All Rights Reserved.</div></body></html>